WITH
BD_100_TRANS_INFONA
AS
(
SELECT
ROWNUM AS CONTADOR_SERVICIO,
T.FTC_FOLIO_BITACORA,
LPAD('0',15,'0')FTN_SALDO_VIVI97_TRAN
FROM PROCESOS.TTCRXGRAL_TRANS_INFONA T
WHERE 1=1 
AND T.FTC_FOLIO_BITACORA = '#SR_FOLIO#' --'202507111704372782' --
AND T.FTC_ESTATUS_REGISTRO = 0
AND T.FTN_ID_SUBP = #SR_SUBPROCESO# -- 368
)
SELECT 
'09' AS TIPO_REGISTRO,
LPAD(CONTADOR_SERVICIO,09,'0') AS CONSECUTIVO,
LPAD(' ',45,' ') AS FILLER,
CASE 
        WHEN FTN_SALDO_VIVI97_TRAN IS NULL THEN LPAD('0',15,'0')
            ELSE 
          LPAD(
          LPAD(SUBSTR(TO_CHAR(FTN_SALDO_VIVI97_TRAN), 1, INSTR(TO_CHAR(FTN_SALDO_VIVI97_TRAN, 'FM9999999999.99'), '.') - 1),13,'0') 
		  || RPAD(SUBSTR(TRIM(TO_CHAR(FTN_SALDO_VIVI97_TRAN, 'FM9999999999.99')||'00'),INSTR(TRIM(TO_CHAR(FTN_SALDO_VIVI97_TRAN, 'FM9999999999.99')||'00'), '.') + 1, 2),2,'0')
          ,15,'0')
END AS FTN_SALDO_VIVI97_TRAN,
LPAD(' ',659,' ') AS FILLER1
FROM
(
SELECT
FTC_FOLIO_BITACORA,
MAX(CONTADOR_SERVICIO) AS CONTADOR_SERVICIO,
SUM(FTN_SALDO_VIVI97_TRAN) AS FTN_SALDO_VIVI97_TRAN
FROM BD_100_TRANS_INFONA
GROUP BY FTC_FOLIO_BITACORA
)