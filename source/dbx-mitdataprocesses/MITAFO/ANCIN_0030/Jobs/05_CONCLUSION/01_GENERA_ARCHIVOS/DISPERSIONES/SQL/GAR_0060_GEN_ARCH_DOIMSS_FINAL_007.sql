SELECT
  COALESCE(FCN_CVE_SIEFORE, '00') AS CVE_SIEFORE,
  COALESCE(FTN_NUM_CTA_INVDUAL, '0000000000') AS FTN_NUM_CTA_INVDUAL,
  '0' AS DVCUE,
  LPAD(
    ROW_NUMBER() OVER (PARTITION BY FFN_COD_MOV_ITGY ORDER BY FTN_NUM_CTA_INVDUAL, FCN_CVE_SIEFORE),
    8,
    0
  ) AS NUMREG,
  COALESCE(FFN_COD_MOV_ITGY, '000') AS FFN_CODMOV,
  COALESCE(FNN_NSS_ISSSTE_SUA || RPAD(' ', 11 - LENGTH(FNN_NSS_ISSSTE_SUA)), ' ') AS NSSTRA,
  COALESCE(FND_FEH_CRE_SUA, '00000000') AS FCD_FECPRO,
  COALESCE(FTN_ID_ARCHIVO, '0000000') AS SECPRO,
  COALESCE(FTD_FEH_LIQUIDACION, '00000000') AS FTD_FEHCCON,
  COALESCE(FCN_VALOR_ACCION, '000000000000') AS FCN_VALOR_ACCION,
  COALESCE(FND_FECTRA_SUA, '00000000') AS FECTRA,
  COALESCE(FNN_SECLOT_SUA, '000') AS SECLOT,
  COALESCE(FNN_ID_REFERENCIA, '00000000') AS FNN_CORREL,
  COALESCE(FND_FECHA_PAGO_SUA, '00000000') AS FND_FECHA_PAGO,
  COALESCE(FNC_PERIODO_PAGO_PATRON, '000000') AS FNC_PERIODO_PAGO_PATRON,
  COALESCE(FNC_FOLIO_PAGO_SUA, '000000') AS FNC_FOLIO_PAGO_SUA,
  COALESCE(FND_FECHA_PAGO_SUA, '00000000') AS FECSUA,
  COALESCE(FNC_REG_PATRN_IMSS_SUA || RPAD(' ', 11 - LENGTH(FNC_REG_PATRN_IMSS_SUA)), ' ') AS NSSEMP,

  -- MONPES#
  COALESCE(LPAD(REPLACE(TO_CHAR(SUM(FTF_MONPES1), 'FM9999999999999.90'), '.'), 15, '0'), '000000000000000') AS MONPES1,
  COALESCE(LPAD(REPLACE(TO_CHAR(SUM(FTF_MONPES2), 'FM9999999999999.90'), '.'), 15, '0'), '000000000000000') AS MONPES2,
  COALESCE(LPAD(REPLACE(TO_CHAR(SUM(FTF_MONPES3), 'FM9999999999999.90'), '.'), 15, '0'), '000000000000000') AS MONPES3,
  COALESCE(LPAD(REPLACE(TO_CHAR(SUM(FTF_MONPES4), 'FM9999999999999.90'), '.'), 15, '0'), '000000000000000') AS MONPES4,
  COALESCE(LPAD(REPLACE(TO_CHAR(SUM(FTF_MONPES5), 'FM9999999999999.90'), '.'), 15, '0'), '000000000000000') AS MONPES5,
  COALESCE(LPAD(REPLACE(TO_CHAR(SUM(FTF_MONPES6), 'FM9999999999999.90'), '.'), 15, '0'), '000000000000000') AS MONPES6,
  COALESCE(LPAD(REPLACE(TO_CHAR(SUM(FTF_MONPES7), 'FM9999999999999.90'), '.'), 15, '0'), '000000000000000') AS MONPES7,
  COALESCE(LPAD(REPLACE(TO_CHAR(SUM(FTF_MONPES8), 'FM9999999999999.90'), '.'), 15, '0'), '000000000000000') AS MONPES8,
  COALESCE(LPAD(REPLACE(TO_CHAR(SUM(FTF_MONPES9), 'FM9999999999999.90'), '.'), 15, '0'), '000000000000000') AS MONPES9,

  -- MONCUO#
  COALESCE(LPAD(REPLACE(TO_CHAR(SUM(FTF_MONCUO1), 'FM99999999.9999990'), '.'), 15, '0'), '000000000000000') AS MONCUO1,
  COALESCE(LPAD(REPLACE(TO_CHAR(SUM(FTF_MONCUO2), 'FM99999999.9999990'), '.'), 15, '0'), '000000000000000') AS MONCUO2,
  COALESCE(LPAD(REPLACE(TO_CHAR(SUM(FTF_MONCUO3), 'FM99999999.9999990'), '.'), 15, '0'), '000000000000000') AS MONCUO3,
  COALESCE(LPAD(REPLACE(TO_CHAR(SUM(FTF_MONCUO4), 'FM99999999.9999990'), '.'), 15, '0'), '000000000000000') AS MONCUO4,
  COALESCE(LPAD(REPLACE(TO_CHAR(SUM(FTF_MONCUO5), 'FM99999999.9999990'), '.'), 15, '0'), '000000000000000') AS MONCUO5,
  COALESCE(LPAD(REPLACE(TO_CHAR(SUM(FTF_MONCUO6), 'FM99999999.9999990'), '.'), 15, '0'), '000000000000000') AS MONCUO6,
  COALESCE(LPAD(REPLACE(TO_CHAR(SUM(FTF_MONCUO7), 'FM99999999.9999990'), '.'), 15, '0'), '000000000000000') AS MONCUO7,
  COALESCE(LPAD(REPLACE(TO_CHAR(SUM(FTF_MONCUO8), 'FM99999999.9999990'), '.'), 15, '0'), '000000000000000') AS MONCUO8,
  COALESCE(LPAD(REPLACE(TO_CHAR(SUM(FTF_MONCUO9), 'FM99999999.9999990'), '.'), 15, '0'), '000000000000000') AS MONCUO9,

  -- Fechas adicionales
  COALESCE(FND_FECHA_1, '00000000') AS FECHA_1,
  COALESCE(FND_FECHA_2, '00000000') AS FECHA_2,
  COALESCE(FND_FECHA_VALOR_RCV, '00000000') AS FND_FECVRCV,
  COALESCE(FND_FECHA_VALOR_IMSS_ACV_VIV, '00000000') AS FND_FECHA_VALOR_IMSS_ACV_VIV,
  COALESCE(FND_FECVGUB, '00000000') AS FECVGUB,

  -- Constantes
  '01' AS CVESERV,
  COALESCE(FNC_VARMAX, '00000') AS VARMAX

FROM CIERREN_ETL.TTSISGRAL_ETL_GEN_ARCHIVO
WHERE FTC_FOLIO = '#SR_FOLIO#'  -- PAR√ÅMETRO

GROUP BY
  FCN_CVE_SIEFORE,
  FTN_NUM_CTA_INVDUAL,
  FTC_DIG_VERI,
  FFN_COD_MOV_ITGY,
  FNN_NSS_ISSSTE_SUA,
  FND_FEH_CRE_SUA,
  FTN_ID_ARCHIVO,
  FTD_FEH_LIQUIDACION,
  FCN_VALOR_ACCION,
  FND_FECTRA_SUA,
  FNN_SECLOT_SUA,
  FNN_ID_REFERENCIA,
  FND_FECHA_PAGO_SUA,
  FNC_PERIODO_PAGO_PATRON,
  FNC_FOLIO_PAGO_SUA,
  FND_FECHA_PAGO_SUA,
  FNC_REG_PATRN_IMSS_SUA,
  FND_FECHA_1,
  FND_FECHA_2,
  FND_FECHA_VALOR_RCV,
  FND_FECHA_VALOR_IMSS_ACV_VIV,
  FND_FECVGUB,
  FNC_VARMAX

ORDER BY FFN_CODMOV