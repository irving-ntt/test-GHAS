WITH SUM_02 AS
(
	SELECT
		SUM(CAST(substr(FTC_LINEA,181,7) AS INT) + CAST(substr(FTC_LINEA,188,7) AS INT) + CAST(substr(FTC_LINEA,195,7) AS INT) + CAST(substr(FTC_LINEA,202,7) AS INT)) ID_04_01
		,SUM(CASE WHEN substr(FTC_LINEA,280,1) = 0 THEN CAST(substr(FTC_LINEA,223,7) AS INT) ELSE 0 END) ID_04_03
		,SUM(CASE WHEN substr(FTC_LINEA,280,1) = 1 THEN CAST(substr(FTC_LINEA,223,7) AS INT) ELSE 0 END) ID_04_04
		,SUM(CAST(substr(FTC_LINEA,209,7) AS INT)) ID_04_05
		,SUM(CAST(substr(FTC_LINEA,216,7) AS INT)) ID_04_06
		,SUM(CAST(substr(FTC_LINEA,307,7) AS INT)) ID_04_07
		,SUM(CAST(substr(FTC_LINEA,329,7) AS INT)) ID_04_08
		,SUM(CAST(substr(FTC_LINEA,351,7) AS INT)) ID_04_09
		,SUM(CASE WHEN substr(FTC_LINEA,280,1) = 0 THEN CAST(substr(FTC_LINEA,281,15) AS INT) ELSE 0 END) ID_08_03
		,SUM(CASE WHEN substr(FTC_LINEA,280,1) = 1 THEN CAST(substr(FTC_LINEA,281,15) AS INT) ELSE 0 END) ID_08_04
		,SUM(CAST(substr(FTC_LINEA,314,15) AS INT)) ID_11_07
		,SUM(CAST(substr(FTC_LINEA,336,15) AS INT)) ID_14_08
	FROM #DELTA_TABLE_NAME_001#
	WHERE 1 = 1
		AND substr(FTC_LINEA,1,2) = '02'
)
SELECT
	FTN_NO_LINEA
	,CASE WHEN substr(FTC_LINEA,1,2) = '08' then NULL else substr(FTC_LINEA,1,2) end `Error_en_Tipo_de_registro_diferente_a_'08'`
	,CASE WHEN substr(FTC_LINEA,3,2) = '03' then NULL else substr(FTC_LINEA,3,2) end `Error_en_Identificador_del_servicio_diferente_a_'03'`
	,CASE WHEN length(trim(substr(FTC_LINEA,5,16))) = 0 then NULL else substr(FTC_LINEA,5,16) end `Error_en_Identificador_de_Pago_Invalido`
	,CASE WHEN substr(FTC_LINEA,5,16) = '0000000000000001' THEN CASE WHEN CAST(substr(FTC_LINEA,21,15) AS DOUBLE) = SUM_02.ID_04_01 THEN NULL ELSE CONCAT(substr(FTC_LINEA,21,15), '<>', CAST(SUM_02.ID_04_01 AS STRING)) END ELSE NULL END `Error_en_Diferencia_RCV_detalle_08_vs_detalle_02`
	,CASE WHEN substr(FTC_LINEA,5,16) = '0000000000000003' THEN CASE WHEN CAST(substr(FTC_LINEA,21,15) AS DOUBLE) = SUM_02.ID_04_03 THEN NULL ELSE CONCAT(substr(FTC_LINEA,21,15), '<>', CAST(SUM_02.ID_04_03 AS STRING)) END ELSE NULL END `Error_en_Diferencia_VIVIENDA_97_detalle_08_vs_detalle_02`
	,CASE WHEN substr(FTC_LINEA,5,16) = '0000000000000004' THEN CASE WHEN CAST(substr(FTC_LINEA,21,15) AS DOUBLE) = SUM_02.ID_04_04 THEN NULL ELSE CONCAT(substr(FTC_LINEA,21,15), '<>', CAST(SUM_02.ID_04_04 AS STRING)) END ELSE NULL END `Error_en_Diferencia_VIVIENDA_97_EN_GARANTIA_detalle_08_vs_detalle_02`
	,CASE WHEN substr(FTC_LINEA,5,16) = '0000000000000005' THEN CASE WHEN CAST(substr(FTC_LINEA,21,15) AS DOUBLE) = SUM_02.ID_04_05 THEN NULL ELSE CONCAT(substr(FTC_LINEA,21,15), '<>', CAST(SUM_02.ID_04_05 AS STRING)) END ELSE NULL END `Error_en_Diferencia_APORTACIONES_VOLUNTARIAS_detalle_08_vs_detalle_02`
	,CASE WHEN substr(FTC_LINEA,5,16) = '0000000000000006' THEN CASE WHEN CAST(substr(FTC_LINEA,21,15) AS DOUBLE) = SUM_02.ID_04_06 THEN NULL ELSE CONCAT(substr(FTC_LINEA,21,15), '<>', CAST(SUM_02.ID_04_06 AS STRING)) END ELSE NULL END `Error_en_Diferencia_APORTACIONES_COMPLEMENTARIAS_DE_RETIRO_detalle_08_vs_detalle_02`
	,CASE WHEN substr(FTC_LINEA,5,16) = '0000000000000007' THEN CASE WHEN CAST(substr(FTC_LINEA,21,15) AS DOUBLE) = SUM_02.ID_04_07 THEN NULL ELSE CONCAT(substr(FTC_LINEA,21,15), '<>', CAST(SUM_02.ID_04_07 AS STRING)) END ELSE NULL END `Error_en_Diferencia_VIVIENDA_97_POR_CONCEPTO_DE_REMANENTE_PAGO_13_detalle_08_vs_detalle_02`
	,CASE WHEN substr(FTC_LINEA,5,16) = '0000000000000008' THEN CASE WHEN CAST(substr(FTC_LINEA,21,15) AS DOUBLE) = SUM_02.ID_04_08 THEN NULL ELSE CONCAT(substr(FTC_LINEA,21,15), '<>', CAST(SUM_02.ID_04_08 AS STRING)) END ELSE NULL END `Error_en_Diferencia_VIVIENDA_97_POR_CONCEPTO_DE_PAGOS_EXTEMPORANEOS_DE_VIVIENDA_detalle_08_vs_detalle_02`
	,CASE WHEN substr(FTC_LINEA,5,16) = '0000000000000009' THEN CASE WHEN CAST(substr(FTC_LINEA,21,15) AS DOUBLE) = SUM_02.ID_04_09 THEN NULL ELSE CONCAT(substr(FTC_LINEA,21,15), '<>', CAST(SUM_02.ID_04_09 AS STRING)) END ELSE NULL END `Error_en_Diferencia_APORTACIONES_DE_AHORRO_A_LARGO_PLAZO_detalle_08_vs_detalle_02`
	,CASE WHEN TO_DATE(substr(FTC_LINEA,36,8), 'yyyyMMdd') IS NOT NULL then NULL else substr(FTC_LINEA,36,8) end `Error_en_Fecha_de_Liquidacion`
	,CASE WHEN substr(FTC_LINEA,44,15) = '000000000000000' then NULL else substr(FTC_LINEA,44,15) end `Error_en_Importe_aportaciones_aceptadas_diferente_a_cero`
	,CASE WHEN substr(FTC_LINEA,59,15) = '000000000000000' then NULL else substr(FTC_LINEA,59,15) end `Error_en_Importe_aportaciones_devueltas_diferente_a_cero`
	,CASE WHEN substr(FTC_LINEA,74,18) = '000000000000000003' THEN CASE WHEN CAST(substr(FTC_LINEA,281,15) AS DOUBLE) = SUM_02.ID_08_03 THEN NULL ELSE concat(substr(FTC_LINEA,281,15), '<>', CAST(SUM_02.ID_08_03 AS STRING)) END ELSE NULL END `Error_en_Diferencia_AIVS_VIVIENDA_97_detalle_08_vs_detalle_02`
	,CASE WHEN substr(FTC_LINEA,74,18) = '000000000000000004' THEN CASE WHEN CAST(substr(FTC_LINEA,281,15) AS DOUBLE) = SUM_02.ID_08_04 THEN NULL ELSE concat(substr(FTC_LINEA,281,15), '<>', CAST(SUM_02.ID_08_04 AS STRING)) END ELSE NULL END `Error_en_Diferencia_AIVS_DE_VIVIENDA_97_EN_GARANTIA_detalle_08_vs_detalle_02`
	,CASE WHEN substr(FTC_LINEA,92,18) = '000000000000000000' then NULL else substr(FTC_LINEA,92,18) end `Error_en_AIVS_Vivienda_97_aceptadas_diferente_a_cero`
	,CASE WHEN substr(FTC_LINEA,110,18) = '000000000000000000' then NULL else substr(FTC_LINEA,110,18) end `Error_en_AIVS_Vivienda_97_devueltas_diferente_a_cero`
	,CASE WHEN substr(FTC_LINEA,5,16) = '0000000000000007' THEN CASE WHEN CAST(substr(FTC_LINEA,128,18) AS DOUBLE) = SUM_02.ID_11_07 THEN NULL ELSE CONCAT(substr(FTC_LINEA,128,18), '<>', CAST(SUM_02.ID_11_07 AS STRING)) END ELSE NULL END `Error_en_Diferencia_AIVS_VIVIENDA_97_POR_CONCEPTO_DE_REMANENTE_PAGO_13_detalle_08_vs_detalle_02`
	,CASE WHEN substr(FTC_LINEA,146,18) = '000000000000000000' then NULL else substr(FTC_LINEA,146,18) end `Error_en_AIVS_Vivienda_97_aceptadas_por_concepto_de_Remanente_diferente_a_cero`
	,CASE WHEN substr(FTC_LINEA,164,18) = '000000000000000000' then NULL else substr(FTC_LINEA,164,18) end `Error_en_AIVS_Vivienda_97_devueltas_por_concepto_de_Remanente_diferente_a_cero`
	,CASE WHEN substr(FTC_LINEA,5,16) = '0000000000000008' THEN CASE WHEN CAST(substr(FTC_LINEA,182,18) AS DOUBLE) = SUM_02.ID_14_08 THEN NULL ELSE CONCAT(substr(FTC_LINEA,182,18),'<>', CAST(SUM_02.ID_14_08 AS STRING)) END ELSE NULL END `Error_en_Diferencia_AIVS_VIVENDA_97_POR_CONCEPTO_DE_PAGOS_EXTEMPORANEOS_detalle_08_vs_detalle_02`
	,CASE WHEN substr(FTC_LINEA,200,18) = '000000000000000000' then NULL else substr(FTC_LINEA,200,18) end `Error_en_AIVS_Vivienda_97_aceptadas_por_concepto_de_Pagos_Extemporaneos_diferente_a_cero`
	,CASE WHEN substr(FTC_LINEA,218,18) = '000000000000000000' then NULL else substr(FTC_LINEA,218,18) end `Error_en_AIVS_Vivienda_97_devueltas_por_concepto_de_Pagos_Extemporaneos_diferente_a_cero`
FROM #DELTA_TABLE_NAME_001# RES_08
	JOIN SUM_02 SUM_02 ON 1 = 1
WHERE 1 = 1
	AND substr(FTC_LINEA,1,2) != '01'
	AND substr(FTC_LINEA,1,2) != '02'
	AND substr(FTC_LINEA,1,2) != '09'