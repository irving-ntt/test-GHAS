{
  "flow" : "DOIMSS",
  "id" : "5",
  "steps" :
    [
        {
          "step_id" : "001",
          "subprocess" : "MVC",
          "description" : [
            "descripcion - Query Job ",
            "#PARAM@1# = #p_SR_FOLIO_REL# = Numero  de folio"
          ],
          "value": [
              "SELECT ",
              "FTN_NUM_CTA_INVDUAL",
              ",FCN_ID_TIPO_SUBCTA",
              ",NVL(FTN_MONTO_DISP,0) FTN_MONTO_DISP",
              ",ROUND(NVL(FTN_MONTO_DISP,0)*NVL(FCN_VALOR_ACCION,0),2) FTN_MONTO_DISP_PESOS",
              "FROM ",
              "(",
              "select MAX(FTC_FOLIO),",
              "       MAX(FTC_FOLIO_REL),",
              "       MAX(FCN_ID_PROCESO),",
              "       MAX(FCN_ID_SUBPROCESO),",
              "       MAX(FCN_ID_TIPO_MONTO),",
              "       MAX(BAL.FTN_MONTO) FTN_MONTO_DISP,",
              "       MC.FTN_NUM_CTA_INVDUAL,",
              "       MC.FCN_ID_TIPO_SUBCTA,",
              "       VA.FCN_VALOR_ACCION",
              "FROM",
              "    CIERREN_DATAUX.TTSISGRAL_ETL_MONTOS_CLIENTE_AUX MC",
              "LEFT JOIN (",
              "    SELECT ",
              "        B1.FTN_NUM_CTA_INVDUAL",
              "        ,B1.FCN_ID_TIPO_SUBCTA",
              "        ,B1.FCN_ID_SIEFORE",
              "        ,A1.FCN_ID_REGIMEN",
              "        ,B1.FTN_MONTO",
              "    FROM (",
              "        SELECT DISTINCT FCN_ID_TIPO_SUBCTA",
              "            ,FCN_ID_REGIMEN",
              "        FROM CIERREN.TCCRXGRAL_TIPO_SUBCTA A",
              "        ) A1",
              "    INNER JOIN (",
              "        SELECT BAL.FTC_NUM_CTA_INVDUAL FTN_NUM_CTA_INVDUAL",
              "            ,BAL.FCN_ID_TIPO_SUBCTA",
              "            ,BAL.FCN_ID_SIEFORE",
              "            ,SUM(BAL.FTN_DISP_ACCIONES) FTN_MONTO",
              "        FROM CIERREN.TTAFOGRAL_BALANCE_MOVS BAL",
              "        INNER JOIN CIERREN_DATAUX.TTSISGRAL_ETL_MONTOS_CLIENTE_AUX MC ON (BAL.FTC_NUM_CTA_INVDUAL = MC.FTN_NUM_CTA_INVDUAL)",
              "        WHERE MC.FTC_FOLIO_REL = '#PARAM@1#'",
              "        GROUP BY BAL.FTC_NUM_CTA_INVDUAL",
              "            ,BAL.FCN_ID_TIPO_SUBCTA",
              "            ,BAL.FCN_ID_SIEFORE",
              "        ) B1 ON A1.FCN_ID_TIPO_SUBCTA = B1.FCN_ID_TIPO_SUBCTA",
              "    ) BAL ON (",
              "        BAL.FTN_NUM_CTA_INVDUAL = MC.FTN_NUM_CTA_INVDUAL",
              "        AND BAL.FCN_ID_TIPO_SUBCTA = MC.FCN_ID_TIPO_SUBCTA",
              "        )",
              "INNER JOIN CIERREN.TCAFOGRAL_VALOR_ACCION VA ON (",
              "        VA.FCN_ID_SIEFORE = BAL.FCN_ID_SIEFORE",
              "        AND VA.FCN_ID_REGIMEN = BAL.FCN_ID_REGIMEN",
              "        )",
              "WHERE  TRUNC(FCD_FEH_ACCION) = TO_DATE(#PARAM@2#,'YYYYMMDD')",
              "GROUP BY",
              "    MC.FTN_NUM_CTA_INVDUAL,",
              "    MC.FCN_ID_TIPO_SUBCTA,",
              "VA.FCN_VALOR_ACCION",
              ") A"
          ]
        },
 {
          "step_id" : "002",
          "subprocess" : "MVC",
          "description" : [
            "descripcion - Este query para el reproceso el cu√°l genera la tabla TEMP_DOIMSS_MCV_MONTOS_CLIENTE",
            "#PARAM@1# = #p_SR_PROCESO# = Proceso",
            "#PARAM@2# = #p_SR_SUBPROCESO# = Subproceso",
            "#PARAM@3# = #p_SR_TIPO_MOV# = Tipo de movimiento Cargo o Abono"
          ],
          "value": [
              "select MDCI.FTC_FOLIO,",
              "       MDCI.FTC_FOLIO_REL,",
              "       MDCI.FCN_ID_PROCESO,",
              "       CAST(MDCI.FCN_ID_SUBPROCESO AS int) FCN_ID_SUBPROCESO,",
              "       MDCI.FCN_ID_TIPO_MONTO,",
              "       MDCI.FTN_MONTO,",
              "       MDCI.FTN_NUM_CTA_INVDUAL,",
              "       MDCI.FCN_ID_TIPO_SUBCTA,",
              "       CONF.TCN_TIPO_SALDO_OPERA,",
              "       CAST(MATRIZ.FCN_ID_SUBPROCESO_CON AS int) FCN_ID_SUBPROCESO_CON,",
              "       MATRIZ.FCN_ID_TIPO_SUBCTA_CON,",
              "       MATRIZ.FRN_ID_MOV_SUBCTA,",
              "       MATRIZ.FCN_ID_TIPO_MONTO_CON",
              "FROM",
              "    CIERREN_DATAUX.TTSISGRAL_ETL_MONTOS_CLIENTE_AUX MDCI",
              "LEFT JOIN (",
              "SELECT CON.FCN_ID_PROCESO",
              "              ,CON.FCN_ID_SUBPROCESO",
              "              ,CON.FCN_ID_SALDO_OPERA as TCN_TIPO_SALDO_OPERA",
              "FROM CIERREN.TFAFOGRAL_CONFIG_SUBPROCESO CON   ",
              "WHERE CON.FCN_ID_PROCESO = #PARAM@1#  ",
              "AND       CON.FCN_ID_SUBPROCESO = #PARAM@2#",
              "ORDER BY CON.FCN_ID_PROCESO, CON.FCN_ID_SUBPROCESO ASC",
              ") CONF ON (MDCI.FCN_ID_PROCESO   = CONF.FCN_ID_PROCESO",
              "AND MDCI.FCN_ID_SUBPROCESO = CONF.FCN_ID_SUBPROCESO)",
              "",
              "",
              "left join (",
              "",
              "SELECT  MAT.FTN_NUM_CTA_INVDUAL",
              "        ,MAX(MAT.TCN_TIPO_SALDO_OPERA)",
              "        ,MAT.FRN_ID_MOV_SUBCTA        ",
              "        ,MAX(SUBC.FCN_ID_SUBPROCESO) FCN_ID_SUBPROCESO_CON",
              "        ,MAX(SUBC.FCN_ID_TIPO_SUBCTA) FCN_ID_TIPO_SUBCTA_CON",
              "        ,MAX(MAT.FCN_ID_TIPO_MONTO) FCN_ID_TIPO_MONTO_CON",
              "FROM      CIERREN.TTAFOGRAL_MATRIZ_CONVIVENCIA  MAT",
              "INNER JOIN CIERREN_DATAUX.TTSISGRAL_ETL_MONTOS_CLIENTE_AUX M_CTE ON MAT.FTN_NUM_CTA_INVDUAL = M_CTE.FTN_NUM_CTA_INVDUAL",
              "LEFT JOIN CIERREN.TRAFOGRAL_MOV_SUBCTA SUBC",
              "ON MAT.FRN_ID_MOV_SUBCTA=SUBC.FRN_ID_MOV_SUBCTA",
              "WHERE M_CTE.FTC_FOLIO = '#PARAM@4#'",
              "AND MAT.FTB_ESTATUS_MARCA = '1' ",
              "AND SUBC.FCN_ID_TIPO_MOV = '#PARAM@3#'",
              "AND SUBC.FRB_VIGENCIA = 1",
              "GROUP BY MAT.FTN_NUM_CTA_INVDUAL, MAT.FRN_ID_MOV_SUBCTA ",
              ") MATRIZ ON MATRIZ.FTN_NUM_CTA_INVDUAL = MDCI.FTN_NUM_CTA_INVDUAL ",
              "WHERE MDCI.FTC_FOLIO = '#PARAM@4#'"
          ]
        },
{
          "step_id" : "003",
          "subprocess" : "MVC",
          "description" : [
            "descripcion - Este query obtiene la configuracion de los subprocesos que conviven",
            "#PARAM@1# = #p_SR_PROCESO# = Proceso",
            "#PARAM@2# = #p_SR_SUBPROCESO# = Subproceso",
            "#PARAM@3# = #p_SR_TIPO_MOV# = Tipo de movimiento Cargo o Abono"
          ],
          "value": [
              "SELECT  FFB_CONVIVENCIA",
              "       ,CAST(FCN_ID_SUBPROCESO AS int) FCN_ID_SUBPROCESO",
              "       ,CAST(FCN_ID_SUBPROCESO_CON AS int) FCN_ID_SUBPROCESO_CON",
              "       ,FFB_VIGENTE",              
              "FROM  CIERREN.TFAFOGRAL_CONFIG_CONVIV ",
              "WHERE FFB_VIGENTE = 1"
          ]
        },
{
          "step_id" : "004",
          "subprocess" : "MVC",
          "description" : [
            "descripcion - Este query obtiene la configuracion de los subprocesos que conviven",
            "#PARAM@1# = #p_SR_FOLIO# = FOLIO DEL PROCESO",
            "#PARAM@2# = #catalog_name# = Catalog tabla delta",
            "#PARAM@3# = #schema# = Esquema tabla delta"
          ],
          "value": [
              "SELECT MD_MT.FTC_FOLIO",
              "    ,MD_MT.FTC_FOLIO_REL",
              "    ,CAST(MD_MT.FCN_ID_PROCESO AS int) FCN_ID_PROCESO",
              "    ,CAST(MD_MT.FCN_ID_SUBPROCESO AS int) FCN_ID_SUBPROCESO",
              "    ,MD_MT.FCN_ID_TIPO_MONTO",
              "    ,MD_MT.FTN_MONTO",
              "    ,MD_MT.FTN_NUM_CTA_INVDUAL",
              "    ,CAST(MD_MT.FCN_ID_TIPO_SUBCTA AS int) FCN_ID_TIPO_SUBCTA",
              "    ,MD_MT.TCN_TIPO_SALDO_OPERA",
              "    ,CAST(MD_MT.FCN_ID_SUBPROCESO_CON AS int) FCN_ID_SUBPROCESO_CON",
              "    ,CAST(MD_MT.FCN_ID_TIPO_SUBCTA_CON AS int) FCN_ID_TIPO_SUBCTA_CON",
              "    ,CAST(MD_MT.FCN_ID_TIPO_MONTO_CON AS int) FCN_ID_TIPO_MONTO_CON",
              "    ,CAST(MD_MT.FRN_ID_MOV_SUBCTA AS int) FRN_ID_MOV_SUBCTA",              
              "    ,CF_CONV.FFB_CONVIVENCIA",
              "FROM #PARAM@2#.#PARAM@3#.TEMP_DOIMSS_MCV_03_CONVIV_#PARAM@1# MD_MT",
              "LEFT JOIN #PARAM@2#.#PARAM@3#.DS_CONFIG_CONVIV_#PARAM@1# CF_CONV ON (",
              "        MD_MT.FCN_ID_SUBPROCESO = CF_CONV.FCN_ID_SUBPROCESO",
              "        AND MD_MT.FCN_ID_SUBPROCESO_CON = CF_CONV.FCN_ID_SUBPROCESO_CON",
              "        )",
              "WHERE MD_MT.FCN_ID_SUBPROCESO_CON IS NOT NULL",
              "    AND CF_CONV.FFB_VIGENTE = 1"
          ]
        },
{
          "step_id" : "005",
          "subprocess" : "MVC",
          "description" : [
            "descripcion - Este query obtiene vista T_MONT",
            "#PARAM@1# = #p_SR_PROCESO# = Proceso",
            "#PARAM@2# = #p_SR_SUBPROCESO# = Subproceso",
            "#PARAM@3# = #p_SR_TIPO_MOV# = Tipo de movimiento Cargo o Abono"
          ],
          "value": [
              "SELECT CAT.FCN_ID_CAT_CATALOGO as FCN_ID_CAT_SUBCTA",
              "     ,CAT.FCC_VALOR",
              "FROM  CIERREN.TCCRXGRAL_TIPO_CAT TC",
              "     ,CIERREN.TCCRXGRAL_CAT_CATALOGO CAT ",
              "WHERE TC.FCN_ID_TIPO_CAT = CAT.FCN_ID_TIPO_CAT",
              "AND   TC.FCN_ID_TIPO_CAT = 26 ",
              "AND   TC.FCB_VIGENCIA = 1 ",
              "AND   CAT.FCB_VIGENCIA = 1"
          ]
        },
{
          "step_id" : "006",
          "subprocess" : "MVC",
          "description" : [
            "descripcion - Este query genera vista DS_300_REG_NO_CONVIVEN",
            "#PARAM@1# = #p_SR_PROCESO# = Proceso",
            "#PARAM@2# = #p_SR_SUBPROCESO# = Subproceso",
            "#PARAM@3# = #p_SR_TIPO_MOV# = Tipo de movimiento Cargo o Abono"
          ],
          "value": [
              "SELECT ",
              "     FTC_FOLIO",
              "    ,FTC_FOLIO_REL",
              "    ,CAST(FCN_ID_PROCESO AS int) FCN_ID_PROCESO",
              "    ,CAST(FCN_ID_SUBPROCESO AS int) FCN_ID_SUBPROCESO",
              "    ,FTN_NUM_CTA_INVDUAL",
              "    ,FCN_ID_TIPO_SUBCTA",
              "    ,FTN_MONTO",
              "    ,FCN_ID_TIPO_MONTO",
              "    ,CAST(FCN_ID_SUBPROCESO_CON AS int) FTN_ID_SUBPROC_NO_CONV",
              "    ,421 FTN_ID_ERROR_VAL",
              "    ,0 FTB_ESTATUS_MARCA",
              "FROM  #PARAM@2#.#PARAM@3#.TEMP_DOIMSS_MCV_04_SUBPROCESO_#PARAM@1#",
              "WHERE FFB_CONVIVENCIA <> '1' ",
              "AND FFB_CONVIVENCIA IS NOT NULL",
              "",
              "",
              "UNION ALL ",
              "",
              "",
              "SELECT ",
              "     DISP.FTC_FOLIO",
              "    ,DISP.FTC_FOLIO_REL",
              "    ,CAST(DISP.FCN_ID_PROCESO AS int) FCN_ID_PROCESO",
              "    ,CAST(DISP.FCN_ID_SUBPROCESO AS int) FCN_ID_SUBPROCESO",
              "    ,DISP.FTN_NUM_CTA_INVDUAL",
              "    ,DISP.FCN_ID_TIPO_SUBCTA",
              "    ,DISP.FTN_MONTO   ",
              "    ,DISP.FCN_ID_TIPO_MONTO",
              "    ,NULL FTN_ID_SUBPROC_NO_CONV",
              "    ,282 FTN_ID_ERROR_VAL",
              "    ,0 FTB_ESTATUS_MARCA",
              "FROM #PARAM@2#.#PARAM@3#.TEMP_DOIMSS_MCV_04_SUBPROCESO_#PARAM@1# DISP",
              "INNER JOIN #PARAM@2#.#PARAM@3#.T_MONT_#PARAM@1# T_MONT ON T_MONT.FCN_ID_CAT_SUBCTA = DISP.FCN_ID_TIPO_MONTO ",
              "INNER JOIN #PARAM@2#.#PARAM@3#.T_MONT_CON_#PARAM@1# T_MONT_CON  ON T_MONT.FCN_ID_CAT_SUBCTA = DISP.FCN_ID_TIPO_MONTO_CON ",
              "WHERE (FFB_CONVIVENCIA='1' OR FFB_CONVIVENCIA IS NULL)",
              "and (FCN_ID_TIPO_SUBCTA = FCN_ID_TIPO_SUBCTA_CON)",
              "AND ((CAST(DISP.FCN_ID_PROCESO AS int) NOT IN (7) AND CAST(DISP.FCN_ID_SUBPROCESO AS int) NOT IN (9)) ",
              "OR (CAST(DISP.FCN_ID_PROCESO AS int) NOT IN (7) AND CAST(DISP.FCN_ID_SUBPROCESO AS int) NOT IN (105)))",
              "",
              "    AND (",
              "        (",
              "            T_MONT.FCC_VALOR = 'PESOS'",
              "            AND T_MONT_CON.FCC_VALOR = 'ACCIONES'",
              "            )",
              "        OR (",
              "            T_MONT.FCC_VALOR = 'PESOS'",
              "            AND T_MONT_CON.FCC_VALOR = 'AIVS'",
              "            )",
              "        OR (",
              "            T_MONT.FCC_VALOR = 'PESOS'",
              "            AND T_MONT_CON.FCC_VALOR = 'PESOS'",
              "            )",
              "        )"
          ]
        },
{
          "step_id" : "007",
          "subprocess" : "MVC",
          "description" : [
            "descripcion - Este query genera vista DS_300_REG_NO_CONVIVEN",
            "#PARAM@1# = #sr_folio# = Folio del proceso",
            "#PARAM@2# = #SR_PROCESO# = Subproceso",
            "#PARAM@3# = #p_SR_SUBPROCESO# = Subproceso",
            "#PARAM@4# = #p_SR_TIPO_MOV# = Tipo de movimiento Cargo o Abono"
          ],
          "value": [
              "SELECT FTC_FOLIO",
              "    ,FTC_FOLIO_REL",
              "    ,FCN_ID_PROCESO",
              "    ,FCN_ID_SUBPROCESO",
              "    ,FTN_NUM_CTA_INVDUAL",
              "    ,FCN_ID_TIPO_SUBCTA",
              "    ,FTN_MONTO",
              "    ,FCN_ID_TIPO_MONTO",
              "    ,TCN_TIPO_SALDO_OPERA",
              "    ,FRN_ID_MOV_SUBCTA --",
              "    ,FCN_ID_SUBPROCESO_CON",
              "    ,FCN_ID_TIPO_SUBCTA_CON",
              "    ,FCN_ID_TIPO_MONTO_CON",
              "FROM #PARAM@2#.#PARAM@3#.temp_doimss_mcv_03_conviv_#PARAM@1# MD_MT",
              "WHERE MD_MT.FCN_ID_SUBPROCESO_CON IS NULL",
              "",
              "UNION ALL",
              "",
              "SELECT FTC_FOLIO",
              "    ,FTC_FOLIO_REL",
              "    ,FCN_ID_PROCESO",
              "    ,FCN_ID_SUBPROCESO",
              "    ,FTN_NUM_CTA_INVDUAL",
              "    ,FCN_ID_TIPO_SUBCTA",
              "    ,FTN_MONTO",
              "    ,FCN_ID_TIPO_MONTO",
              "    ,TCN_TIPO_SALDO_OPERA",
              "    ,FRN_ID_MOV_SUBCTA --",
              "    ,FCN_ID_SUBPROCESO_CON",
              "    ,FCN_ID_TIPO_SUBCTA_CON",
              "    ,FCN_ID_TIPO_MONTO_CON",
              "FROM  #PARAM@2#.#PARAM@3#.temp_doimss_mcv_04_subproceso_#PARAM@1#",
              "WHERE (",
              "        FFB_CONVIVENCIA = '1'",
              "        OR FFB_CONVIVENCIA IS NULL",
              "        )",
              "    AND FCN_ID_TIPO_SUBCTA <> FCN_ID_TIPO_SUBCTA_CON",
              "",
              "UNION ALL",
              "",
              "SELECT FTC_FOLIO",
              "    ,FTC_FOLIO_REL",
              "    ,FCN_ID_PROCESO",
              "    ,FCN_ID_SUBPROCESO",
              "    ,FTN_NUM_CTA_INVDUAL",
              "    ,FCN_ID_TIPO_SUBCTA",
              "    ,FTN_MONTO",
              "    ,FCN_ID_TIPO_MONTO",
              "    ,TCN_TIPO_SALDO_OPERA",
              "    ,FRN_ID_MOV_SUBCTA --",
              "    ,FCN_ID_SUBPROCESO_CON",
              "    ,FCN_ID_TIPO_SUBCTA_CON",
              "    ,FCN_ID_TIPO_MONTO_CON",
              "FROM  #PARAM@2#.#PARAM@3#.temp_doimss_mcv_04_subproceso_#PARAM@1# DCS",
              "WHERE (",
              "        FFB_CONVIVENCIA = '1'",
              "        OR FFB_CONVIVENCIA IS NULL",
              "        )",
              "    AND FCN_ID_TIPO_SUBCTA = FCN_ID_TIPO_SUBCTA_CON",
              "    AND (",
              "        (",
              "            FCN_ID_PROCESO = 7",
              "            AND FCN_ID_SUBPROCESO = 9",
              "            )",
              "        OR (",
              "            FCN_ID_PROCESO = 7",
              "            AND FCN_ID_SUBPROCESO = 105",
              "            )",
              "        )",
              "",
              "UNION ALL",
              "",
              "SELECT FTC_FOLIO",
              "    ,FTC_FOLIO_REL",
              "    ,FCN_ID_PROCESO",
              "    ,FCN_ID_SUBPROCESO",
              "    ,FTN_NUM_CTA_INVDUAL",
              "    ,FCN_ID_TIPO_SUBCTA",
              "    ,FTN_MONTO",
              "    ,FCN_ID_TIPO_MONTO",
              "    ,TCN_TIPO_SALDO_OPERA",
              "    ,FRN_ID_MOV_SUBCTA --",
              "    ,FCN_ID_SUBPROCESO_CON",
              "    ,FCN_ID_TIPO_SUBCTA_CON",
              "    ,FCN_ID_TIPO_MONTO_CON",
              "FROM  #PARAM@2#.#PARAM@3#.temp_doimss_mcv_04_subproceso_#PARAM@1# DISP",
              "LEFT JOIN  #PARAM@2#.#PARAM@3#.t_mont_#PARAM@1# T_MONT",
              "    ON T_MONT.FCN_ID_CAT_SUBCTA = DISP.FCN_ID_TIPO_MONTO",
              "LEFT JOIN  #PARAM@2#.#PARAM@3#.t_mont_con_#PARAM@1# T_MONT_CON",
              "    ON T_MONT.FCN_ID_CAT_SUBCTA = DISP.FCN_ID_TIPO_MONTO_CON",
              "WHERE (",
              "        FFB_CONVIVENCIA = '1'",
              "        OR FFB_CONVIVENCIA IS NULL",
              "        )",
              "    AND (FCN_ID_TIPO_SUBCTA = FCN_ID_TIPO_SUBCTA_CON)",
              "    AND (",
              "        (",
              "            FCN_ID_PROCESO NOT IN (7)",
              "            AND FCN_ID_SUBPROCESO NOT IN (9)",
              "            )",
              "        OR (",
              "            FCN_ID_PROCESO NOT IN (7)",
              "            AND FCN_ID_SUBPROCESO NOT IN (105)",
              "            )",
              "        )",
              "    AND (",
              "        (",
              "            T_MONT.FCC_VALOR = 'ACCIONES'",
              "            AND T_MONT_CON.FCC_VALOR = 'ACCIONES'",
              "            )",
              "        OR (",
              "            T_MONT.FCC_VALOR = 'ACCIONES'",
              "            AND T_MONT_CON.FCC_VALOR = 'AIVS'",
              "            )",
              "        OR (",
              "            T_MONT.FCC_VALOR = 'AIVS'",
              "            AND T_MONT_CON.FCC_VALOR = 'AIVS'",
              "            )",
              "        OR (",
              "            T_MONT.FCC_VALOR = 'UDIS'",
              "            AND T_MONT_CON.FCC_VALOR = 'UDIS'",
              "            )",
              "        )"
          ]
        },
{
          "step_id" : "008",
          "subprocess" : "MVC",
          "description" : [
            "descripcion - Este query obtiene vista T_MONT",
            "#PARAM@1# = #p_SR_PROCESO# = Proceso",
            "#PARAM@2# = #p_SR_SUBPROCESO# = Subproceso",
            "#PARAM@3# = #p_SR_TIPO_MOV# = Tipo de movimiento Cargo o Abono"
          ],
          "value": [
              "SELECT FTC_FOLIO",
              "    ,FTC_FOLIO_REL",
              "    ,FCN_ID_PROCESO",
              "    ,FCN_ID_SUBPROCESO",
              "    ,FTN_NUM_CTA_INVDUAL",
              "    ,FTN_MONTO",
              "    ,FCN_ID_TIPO_SUBCTA",
              "    ,FTB_ESTATUS_MARCA",
              "    ,FCN_ID_TIPO_MONTO",
              "    ,FTN_ID_SUBPROC_NO_CONV",
              "    ,FTN_ID_ERROR_VAL",
              "FROM  #PARAM@2#.#PARAM@3#.TEMP_DOIMSS_MCV_06_NO_CONVIVEN_#PARAM@1#",
              "",
              "UNION ALL",
              "",
              "--CONVIVE SALDO",
              "SELECT T_SALD.FTC_FOLIO",
              "    ,T_SALD.FTC_FOLIO_REL",
              "    ,T_SALD.FCN_ID_PROCESO",
              "    ,T_SALD.FCN_ID_SUBPROCESO",
              "    ,T_SALD.FTN_NUM_CTA_INVDUAL",
              "    ,T_SALD.FTN_MONTO",
              "    ,T_SALD.FCN_ID_TIPO_SUBCTA",
              "    ,1 FTB_ESTATUS_MARCA",
              "    ,T_SALD.FCN_ID_TIPO_MONTO",
              "    ,NULL FTN_ID_SUBPROC_NO_CONV",
              "    ,NULL FTN_ID_ERROR_VAL",
              "FROM  #PARAM@2#.#PARAM@3#.TEMP_DOIMSS_MCV_05_TIPO_SALDO_#PARAM@1# T_SALD",
              "LEFT JOIN  #PARAM@2#.#PARAM@3#.TEMP_DOIMSS_MCV_SALDOS_DISP_#PARAM@1# SALD_DISP",
              "    ON (",
              "            SALD_DISP.FTN_NUM_CTA_INVDUAL = T_SALD.FTN_NUM_CTA_INVDUAL",
              "            AND SALD_DISP.FCN_ID_TIPO_SUBCTA = T_SALD.FCN_ID_TIPO_SUBCTA",
              "            )",
              "WHERE T_SALD.TCN_TIPO_SALDO_OPERA = 12",
              "    /*VALIDA QUE TENGA SALDO DISPONIBLE*/",
              "    AND (",
              "        FCN_ID_TIPO_MONTO = 184",
              "        AND FTN_MONTO_DISP_PESOS >= NVL(FTN_MONTO, 0)",
              "        OR (",
              "            FTN_MONTO_DISP >= NVL(FTN_MONTO, 0)",
              "            )",
              "        )",
              "",
              "UNION ALL",
              "",
              "SELECT T_SALD.FTC_FOLIO",
              "    ,T_SALD.FTC_FOLIO_REL",
              "    ,T_SALD.FCN_ID_PROCESO",
              "    ,T_SALD.FCN_ID_SUBPROCESO",
              "    ,T_SALD.FTN_NUM_CTA_INVDUAL",
              "    ,T_SALD.FTN_MONTO",
              "    ,T_SALD.FCN_ID_TIPO_SUBCTA",
              "    ,0 FTB_ESTATUS_MARCA",
              "    ,T_SALD.FCN_ID_TIPO_MONTO",
              "    ,NULL FTN_ID_SUBPROC_NO_CONV",
              "    ,283 FTN_ID_ERROR_VAL",
              "FROM  #PARAM@2#.#PARAM@3#.TEMP_DOIMSS_MCV_05_TIPO_SALDO_#PARAM@1# T_SALD",
              "LEFT JOIN  #PARAM@2#.#PARAM@3#.TEMP_DOIMSS_MCV_SALDOS_DISP_#PARAM@1# SALD_DISP",
              "    ON (SALD_DISP.FTN_NUM_CTA_INVDUAL = T_SALD.FTN_NUM_CTA_INVDUAL",
              "            AND SALD_DISP.FCN_ID_TIPO_SUBCTA = T_SALD.FCN_ID_TIPO_SUBCTA",
              "            )",
              "WHERE T_SALD.TCN_TIPO_SALDO_OPERA = 12",
              "    /*OBTIENE REGISTROS DONDE EL MONTO DEL CARGO SEA SUPERIOR AL DISPONIBLE (QUEBRANTO)*/",
              "    AND (",
              "        FCN_ID_TIPO_MONTO = 184",
              "        AND FTN_MONTO_DISP_PESOS < NVL(FTN_MONTO, 0)",
              "        OR (",
             "            FTN_MONTO_DISP < NVL(FTN_MONTO, 0)",
              "            )",
              "        )",
              "",
              "UNION ALL",
              "",
              "SELECT T_SALD.FTC_FOLIO",
              "    ,T_SALD.FTC_FOLIO_REL",
              "    ,T_SALD.FCN_ID_PROCESO",
              "    ,T_SALD.FCN_ID_SUBPROCESO",
              "    ,T_SALD.FTN_NUM_CTA_INVDUAL",
              "    ,T_SALD.FTN_MONTO",
              "    ,T_SALD.FCN_ID_TIPO_SUBCTA",
              "    ,1 FTB_ESTATUS_MARCA",
              "    ,T_SALD.FCN_ID_TIPO_MONTO",
              "    ,NULL FTN_ID_SUBPROC_NO_CONV",
              "    ,NULL FTN_ID_ERROR_VAL",
              "FROM  #PARAM@2#.#PARAM@3#.TEMP_DOIMSS_MCV_05_TIPO_SALDO_#PARAM@1# T_SALD",
              "WHERE TCN_TIPO_SALDO_OPERA <> 12"
          ]
        },
{
          "step_id" : "009",
          "subprocess" : "MVC",
          "description" : [
            "descripcion - Este query obtiene vista T_MONT",
            "#PARAM@1# = #SR_Folio = Folio del proceso",
            "#PARAM@2# = #p_SR_SUBPROCESO# = Subproceso",
            "#PARAM@3# = #p_SR_TIPO_MOV# = Tipo de movimiento Cargo o Abono"
          ],
          "value": [
            "SELECT ",
            "    nvl(TMP_VM.FTC_FOLIO,'') FTC_FOLIO",
            "    ,nvl(TMP_VM.FTC_FOLIO_REL,'') FTC_FOLIO_REL",
            "    ,nvl(TMP_VM.FCN_ID_PROCESO,0) FCN_ID_PROCESO",
            "    ,nvl(TMP_VM.FCN_ID_SUBPROCESO,0) FCN_ID_SUBPROCESO",
            "    ,nvl(TMP_VM.FTN_NUM_CTA_INVDUAL,0) FTN_NUM_CTA_INVDUAL",
            "    ,nvl(TMP_VM.FCN_ID_TIPO_SUBCTA,0) FCN_ID_TIPO_SUBCTA",
            "    ,max(TMP_VM.FTN_MONTO) FTN_MONTO",
            "    ,max(TMP_VM.FCN_ID_TIPO_MONTO) FCN_ID_TIPO_MONTO",
            "    ,to_timestamp(from_utc_timestamp(current_timestamp, 'GMT-6')) FTD_FECHA",
            "    ,max(TMP_VM.FTB_ESTATUS_MARCA) FTC_ESTATUS_MARCA",
            "    ,max(TMP_VM.FTN_ID_SUBPROC_NO_CONV)  FTN_ID_SUBPROC_NO_CONV",
            "    ,max(TMP_VM.FTN_ID_ERROR_VAL) FTN_ID_ERROR_VAL",
            "FROM  #PARAM@2#.#PARAM@3#.TEMP_DOIMSS_MCV_07_VAL_MATRIZ_#PARAM@1# TMP_VM",
            "WHERE TMP_VM.FTC_FOLIO = '#PARAM@1#'",
            "group by ",
            "    nvl(TMP_VM.FTC_FOLIO,'')",
            "    ,nvl(TMP_VM.FTC_FOLIO_REL,'')",
            "    ,nvl(TMP_VM.FCN_ID_PROCESO,0)",
            "    ,nvl(TMP_VM.FCN_ID_SUBPROCESO,0)",
            "    ,nvl(TMP_VM.FTN_NUM_CTA_INVDUAL,0)",
            "    ,nvl(TMP_VM.FCN_ID_TIPO_SUBCTA,0)"
          ]
        }
    ]
}