{
  "flow" : "DOIMSS",
  "id" : "5",
  "steps" :
    [
        {
          "step_id" : "001",
          "subprocess" : "MVC",
          "description" : [
            "descripcion - Este query se utiliza para el reproceso de CARGO Y ABONO el cuál genera la tabla TEMP_DOIMSS_MCV_MONTOS_CLIENTE",
            "#PARAM@1# = #p_SR_FOLIO# = Numero de folio",
            "#PARAM@2# = #p_SR_FOLIO_REL# = Numero de folio",
            "#PARAM@3# = #p_SR_TIPO_MOV# = Tipo de movimiento Cargo o Abono",
            "#PARAM@4# = #p_SR_PROCESO# = Proceso",
            "#PARAM@5# = #p_SR_SUBPROCESO# = Subproceso"
          ],
          "value": [
            "WITH ",
            " TEMP_DISPERSIONES_CLIENTES_IDENTIFICADOS",
            "AS(",
            "    SELECT '#PARAM@1#' FTC_FOLIO",
            "        ,'#PARAM@2#' FTC_FOLIO_REL",
            "        ,DISP.FTN_NUM_CTA_INVDUAL",
            "        ,DISP.FTN_NSS",
            "        ,DISP.FTC_CURP",
            "        ,DISP.FCN_ID_TIPO_SUBCTA FCN_ID_TIPO_SUBCTA",
            "        ,DISP.FTF_MONTO_PESOS",
            "        ,DISP.FTF_MONTO_ACCIONES",
            "        ,DISP.FFN_ID_CONCEPTO_MOV",
            "        ,DISP.FNN_ID_VIV_GARANTIA",
            "        ,DISP.FCN_ID_PROCESO",
            "        ,#PARAM@5# FCN_ID_SUBPROCESO",
            "        ,'#PARAM@3#' AS TIPO_MOV",
            "        ,IDNT.FTN_ESTATUS_DIAG",
            "    FROM CIERREN_ETL.TTSISGRAL_ETL_DISPERSION DISP",
            "    INNER JOIN CIERREN_ETL.TTSISGRAL_ETL_VAL_IDENT_CTE IDNT ON (",
            "            DISP.FTN_NUM_CTA_INVDUAL = IDNT.FTN_NUM_CTA_INVDUAL",
            "            AND (",
            "                DISP.FTN_NSS = IDNT.FTN_NSS",
            "                OR DISP.FTC_CURP = IDNT.FTC_CURP",
            "                )",
            "            )",
            "    WHERE DISP.FTC_FOLIO = DECODE('#PARAM@3#', 'ABONO', '#PARAM@1#', '#PARAM@2#')",
            "    AND IDNT.FTC_FOLIO = DECODE('#PARAM@3#', 'ABONO', '#PARAM@1#', '#PARAM@2#')",
            "        AND (",
            "            DISP.FCN_ID_SUBPROCESO IN (8, 121, 439, 9)",
            "            OR (FCN_ID_SUBPROCESO IN (120, 210, 122, 105))",
            "            AND IDNT.FTN_ESTATUS_DIAG = 1",
            "            )",
            "",
            "),",
            "",
            "TEMP_MAPEO_DISP_CLIENTES_IDENT ",
            "AS",
            "(",
            "SELECT FTC_FOLIO",
            "    ,FCN_ID_PROCESO",
            "    ,FCN_ID_SUBPROCESO",
            "    ,FTN_NUM_CTA_INVDUAL",
            "    ,0 FCN_ID_TIPO_SUBCTA",
            "    ,CASE WHEN FFN_ID_CONCEPTO_MOV IN (637, 638, 1003, 1002) THEN FTF_MONTO_ACCIONES ELSE FTF_MONTO_PESOS END FTF_MONTO",
            "    ,FFN_ID_CONCEPTO_MOV",
            "    ,FTC_FOLIO_REL",
            "    ,TIPO_MOV",
            "FROM TEMP_DISPERSIONES_CLIENTES_IDENTIFICADOS DCI",
            "WHERE TIPO_MOV = 'ABONO'",
            "    AND FFN_ID_CONCEPTO_MOV NOT IN (231, 637, 638, 1002, 1003)",
            "",
            "UNION ALL ",
            "",
            "SELECT FTC_FOLIO",
            "    ,FCN_ID_PROCESO",
            "    ,FCN_ID_SUBPROCESO",
            "    ,FTN_NUM_CTA_INVDUAL",
            "    ,FCN_ID_TIPO_SUBCTA",
            "    ,CASE WHEN FFN_ID_CONCEPTO_MOV IN (637, 638, 1003, 1002) THEN FTF_MONTO_ACCIONES ELSE FTF_MONTO_PESOS END FTF_MONTO",
            "    ,FFN_ID_CONCEPTO_MOV",
            "    ,FTC_FOLIO_REL",
            "    ,TIPO_MOV",
            "FROM TEMP_DISPERSIONES_CLIENTES_IDENTIFICADOS DCI",
            "WHERE TIPO_MOV = 'CARGO'",
            "    AND FFN_ID_CONCEPTO_MOV IN (231, 637, 638, 1003, 1002)",
            "    AND FNN_ID_VIV_GARANTIA = 1",
            "    AND (",
            "        (",
            "            FFN_ID_CONCEPTO_MOV = 231",
            "            AND FTF_MONTO_PESOS > 0",
            "            ) ",
            "        or ",
            "            (",
            "            FFN_ID_CONCEPTO_MOV  in (637, 638,1003,1002)",
            "            AND FTF_MONTO_ACCIONES > 0",
            "            )",
            ")",
            ")",
            "SELECT  ",
            "DCI.FTC_FOLIO",
            "    ,DCI.FCN_ID_PROCESO",
            "    ,DCI.FCN_ID_SUBPROCESO",
            "    ,DCI.FTN_NUM_CTA_INVDUAL",
            "    ,CAST(DECODE('#PARAM@3#','ABONO',0,'CARGO',MSUB.FCN_ID_TIPO_SUBCTA) AS INT) FCN_ID_TIPO_SUBCTA",
            "    ,sum(DCI.FTF_MONTO) FTN_MONTO",
            "    ,DCI.FTC_FOLIO_REL",
            "    ,CMOV.FCN_ID_TIPO_MONTO",
            "FROM   CIERREN.TFAFOGRAL_CONFIG_CONCEP_MOV CMOV ",
            "       INNER JOIN CIERREN.TRAFOGRAL_MOV_SUBCTA MSUB",
            "           ON CMOV.FRN_ID_MOV_SUBCTA = MSUB.FRN_ID_MOV_SUBCTA",
            "       INNER JOIN CIERREN.TCCRXGRAL_CAT_CATALOGO CAT",
            "           ON MSUB.FCN_ID_TIPO_MOV = CAT.FCN_ID_CAT_CATALOGO",
            "       INNER JOIN CIERREN.TCCRXGRAL_TIPO_CAT TCAT",
            "           ON CAT.FCN_ID_TIPO_CAT = TCAT.FCN_ID_TIPO_CAT",
            " inner join TEMP_MAPEO_DISP_CLIENTES_IDENT DCI ON (",
            " (MSUB.FCN_ID_TIPO_SUBCTA = DCI.FCN_ID_TIPO_SUBCTA ",
            " OR DCI.FCN_ID_TIPO_SUBCTA = 0)",
            "        AND DCI.FCN_ID_SUBPROCESO = MSUB.FCN_ID_SUBPROCESO",
            "   AND DCI.FFN_ID_CONCEPTO_MOV = CMOV.FFN_ID_CONCEPTO_MOV",
            "        AND DCI.TIPO_MOV = CAT.FCC_VALOR",
            "        )",
            "INNER JOIN CIERREN_ETL.TLSISGRAL_ETL_VAL_MATRIZ_CONV VAL_MT ON (VAL_MT.FTN_NUM_CTA_INVDUAL = DCI.FTN_NUM_CTA_INVDUAL)",
            "WHERE  VAL_MT.FTC_FOLIO = '#PARAM@1#'",
            "AND VAL_MT.FTB_ESTATUS_MARCA = 0",
            "AND CMOV.FFB_VIGENCIA = 1",
            "AND    MSUB.FCN_ID_SUBPROCESO = #PARAM@5#",
            "AND    TCAT.FCN_ID_TIPO_CAT = 25",
            "AND    TCAT.FCB_VIGENCIA = 1",
            "AND    CAT.FCB_VIGENCIA = 1",
            "GROUP BY DCI.FTN_NUM_CTA_INVDUAL",
            "    ,DCI.FTC_FOLIO",
            "    ,DCI.FTC_FOLIO_REL",
            "    ,DECODE('#PARAM@3#','ABONO',0,'CARGO',MSUB.FCN_ID_TIPO_SUBCTA)",
            "    ,DCI.FCN_ID_PROCESO",
            "    ,DCI.FCN_ID_SUBPROCESO",
            "    ,CMOV.FCN_ID_TIPO_MONTO"
          ]
        },
 {
          "step_id" : "002",
          "subprocess" : "MVC",
          "description" : [
            "descripcion - Este query para el reproceso el cuál genera la tabla TEMP_DOIMSS_MCV_MONTOS_CLIENTE",
            "#PARAM@1# = #p_SR_FOLIO# = Numero de folio",
            "#PARAM@2# = #p_SR_FOLIO_REL# = Numero de folio",
            "#PARAM@3# = #p_SR_TIPO_MOV# = Tipo de movimiento Cargo o Abono",
            "#PARAM@4# = #p_SR_PROCESO# = Proceso",
            "#PARAM@5# = #p_SR_SUBPROCESO# = Subproceso"
          ],
          "value": [
              "UPDATE  CIERREN_ETL.TLSISGRAL_ETL_VAL_MATRIZ_CONV SET FTB_ESTATUS_MARCA = '2' WHERE  FTB_ESTATUS_MARCA = 1 AND FTC_FOLIO = '#PARAM@1#'"
          ]
        },
        {
          "step_id" : "003",
          "subprocess" : "MVC",
          "description" : [
            "descripcion - Este query se utiliza para el reproceso de CARGO Y ABONO el cuál genera la tabla TEMP_DOIMSS_MCV_MONTOS_CLIENTE",
            "#PARAM@1# = #p_SR_FOLIO# = Numero de folio",
            "#PARAM@2# = #p_SR_FOLIO_REL# = Numero de folio",
            "#PARAM@3# = #p_SR_TIPO_MOV# = Tipo de movimiento Cargo o Abono",
            "#PARAM@4# = #p_SR_PROCESO# = Proceso",
            "#PARAM@5# = #p_SR_SUBPROCESO# = Subproceso"
          ],
          "value": [
            "INSERT INTO CIERREN_DATAUX.TTSISGRAL_ETL_MONTOS_CLIENTE_AUX",
            "WITH ",
            " TEMP_DISPERSIONES_CLIENTES_IDENTIFICADOS",
            "AS(",
            "    SELECT '#PARAM@1#' FTC_FOLIO",
            "        ,'#PARAM@2#' FTC_FOLIO_REL",
            "        ,DISP.FTN_NUM_CTA_INVDUAL",
            "        ,DISP.FTN_NSS",
            "        ,DISP.FTC_CURP",
            "        ,DISP.FCN_ID_TIPO_SUBCTA FCN_ID_TIPO_SUBCTA",
            "        ,DISP.FTF_MONTO_PESOS",
            "        ,DISP.FTF_MONTO_ACCIONES",
            "        ,DISP.FFN_ID_CONCEPTO_MOV",
            "        ,DISP.FNN_ID_VIV_GARANTIA",
            "        ,DISP.FCN_ID_PROCESO",
            "        ,#PARAM@5# FCN_ID_SUBPROCESO",
            "        ,'#PARAM@3#' AS TIPO_MOV",
            "        ,IDNT.FTN_ESTATUS_DIAG",
            "    FROM CIERREN_ETL.TTSISGRAL_ETL_DISPERSION DISP",
            "    INNER JOIN CIERREN_ETL.TTSISGRAL_ETL_VAL_IDENT_CTE IDNT ON (",
            "            DISP.FTN_NUM_CTA_INVDUAL = IDNT.FTN_NUM_CTA_INVDUAL",
            "            AND (",
            "                DISP.FTN_NSS = IDNT.FTN_NSS",
            "                OR DISP.FTC_CURP = IDNT.FTC_CURP",
            "                )",
            "            )",
            "    WHERE DISP.FTC_FOLIO = DECODE('#PARAM@3#', 'ABONO', '#PARAM@1#', '#PARAM@2#')",
            "    AND IDNT.FTC_FOLIO = DECODE('#PARAM@3#', 'ABONO', '#PARAM@1#', '#PARAM@2#')",
            "        AND (",
            "            DISP.FCN_ID_SUBPROCESO IN (8, 121, 439, 9)",
            "            OR (FCN_ID_SUBPROCESO IN (120, 210, 122, 105))",
            "            AND IDNT.FTN_ESTATUS_DIAG = 1",
            "            )",
            "",
            "),",
            "",
            "TEMP_MAPEO_DISP_CLIENTES_IDENT ",
            "AS",
            "(",
            "SELECT FTC_FOLIO",
            "    ,FCN_ID_PROCESO",
            "    ,FCN_ID_SUBPROCESO",
            "    ,FTN_NUM_CTA_INVDUAL",
            "    ,0 FCN_ID_TIPO_SUBCTA",
            "    ,CASE WHEN FFN_ID_CONCEPTO_MOV IN (637, 638, 1003, 1002) THEN FTF_MONTO_ACCIONES ELSE FTF_MONTO_PESOS END FTF_MONTO",
            "    ,FFN_ID_CONCEPTO_MOV",
            "    ,FTC_FOLIO_REL",
            "    ,TIPO_MOV",
            "FROM TEMP_DISPERSIONES_CLIENTES_IDENTIFICADOS DCI",
            "WHERE TIPO_MOV = 'ABONO'",
            "    AND FFN_ID_CONCEPTO_MOV NOT IN (231, 637, 638, 1002, 1003)",
            "",
            "UNION ALL ",
            "",
            "SELECT FTC_FOLIO",
            "    ,FCN_ID_PROCESO",
            "    ,FCN_ID_SUBPROCESO",
            "    ,FTN_NUM_CTA_INVDUAL",
            "    ,FCN_ID_TIPO_SUBCTA",
            "    ,CASE WHEN FFN_ID_CONCEPTO_MOV IN (637, 638, 1003, 1002) THEN FTF_MONTO_ACCIONES ELSE FTF_MONTO_PESOS END FTF_MONTO",
            "    ,FFN_ID_CONCEPTO_MOV",
            "    ,FTC_FOLIO_REL",
            "    ,TIPO_MOV",
            "FROM TEMP_DISPERSIONES_CLIENTES_IDENTIFICADOS DCI",
            "WHERE TIPO_MOV = 'CARGO'",
            "    AND FFN_ID_CONCEPTO_MOV IN (231, 637, 638, 1003, 1002)",
            "    AND FNN_ID_VIV_GARANTIA = 1",
            "    AND (",
            "        (",
            "            FFN_ID_CONCEPTO_MOV = 231",
            "            AND FTF_MONTO_PESOS > 0",
            "            ) ",
            "        or ",
            "            (",
            "            FFN_ID_CONCEPTO_MOV  in (637, 638,1003,1002)",
            "            AND FTF_MONTO_ACCIONES > 0",
            "            )",
            ")",
            ")",
            "SELECT  ",
            "DCI.FTC_FOLIO",
            "    ,DCI.FCN_ID_PROCESO",
            "    ,DCI.FCN_ID_SUBPROCESO",
            "    ,DCI.FTN_NUM_CTA_INVDUAL",
            "    ,CAST(DECODE('#PARAM@3#','ABONO',0,'CARGO',MSUB.FCN_ID_TIPO_SUBCTA) AS INT) FCN_ID_TIPO_SUBCTA",
            "    ,sum(DCI.FTF_MONTO) FTN_MONTO",
            "    ,DCI.FTC_FOLIO_REL",
            "    ,CMOV.FCN_ID_TIPO_MONTO",
            "FROM   CIERREN.TFAFOGRAL_CONFIG_CONCEP_MOV CMOV ",
            "       INNER JOIN CIERREN.TRAFOGRAL_MOV_SUBCTA MSUB",
            "           ON CMOV.FRN_ID_MOV_SUBCTA = MSUB.FRN_ID_MOV_SUBCTA",
            "       INNER JOIN CIERREN.TCCRXGRAL_CAT_CATALOGO CAT",
            "           ON MSUB.FCN_ID_TIPO_MOV = CAT.FCN_ID_CAT_CATALOGO",
            "       INNER JOIN CIERREN.TCCRXGRAL_TIPO_CAT TCAT",
            "           ON CAT.FCN_ID_TIPO_CAT = TCAT.FCN_ID_TIPO_CAT",
            " inner join TEMP_MAPEO_DISP_CLIENTES_IDENT DCI ON (",
            " (MSUB.FCN_ID_TIPO_SUBCTA = DCI.FCN_ID_TIPO_SUBCTA ",
            " OR DCI.FCN_ID_TIPO_SUBCTA = 0)",
            "        AND DCI.FCN_ID_SUBPROCESO = MSUB.FCN_ID_SUBPROCESO",
            "   AND DCI.FFN_ID_CONCEPTO_MOV = CMOV.FFN_ID_CONCEPTO_MOV",
            "        AND DCI.TIPO_MOV = CAT.FCC_VALOR",
            "        )",
            "INNER JOIN CIERREN_ETL.TLSISGRAL_ETL_VAL_MATRIZ_CONV VAL_MT ON (VAL_MT.FTN_NUM_CTA_INVDUAL = DCI.FTN_NUM_CTA_INVDUAL)",
            "WHERE  VAL_MT.FTC_FOLIO = '#PARAM@1#'",
            "AND VAL_MT.FTB_ESTATUS_MARCA = 0",
            "AND CMOV.FFB_VIGENCIA = 1",
            "AND    MSUB.FCN_ID_SUBPROCESO = #PARAM@5#",
            "AND    TCAT.FCN_ID_TIPO_CAT = 25",
            "AND    TCAT.FCB_VIGENCIA = 1",
            "AND    CAT.FCB_VIGENCIA = 1",
            "GROUP BY DCI.FTN_NUM_CTA_INVDUAL",
            "    ,DCI.FTC_FOLIO",
            "    ,DCI.FTC_FOLIO_REL",
            "    ,DECODE('#PARAM@3#','ABONO',0,'CARGO',MSUB.FCN_ID_TIPO_SUBCTA)",
            "    ,DCI.FCN_ID_PROCESO",
            "    ,DCI.FCN_ID_SUBPROCESO",
            "    ,CMOV.FCN_ID_TIPO_MONTO"
          ]
        },
        {
          "step_id" : "004",
          "subprocess" : "MVC",
          "description" : [
            "descripcion - Este query genera la tabla TEMP_DOIMSS_MCV_MONTOS_CLIENTE",
            "#PARAM@1# = #p_SR_FOLIO# = Numero de folio",
            "#PARAM@2# = #p_SR_FOLIO_REL# = Numero de folio",
            "#PARAM@3# = #p_SR_TIPO_MOV# = Tipo de movimiento Cargo o Abono",
            "#PARAM@4# = #p_SR_PROCESO# = Proceso",
            "#PARAM@5# = #p_SR_SUBPROCESO# = Subproceso"
          ],
          "value": [
            "SELECT '#PARAM@1#' FTC_FOLIO",
            "    ,'#PARAM@2#' FTC_FOLIO_REL",
            "    ,DISP.FTN_NUM_CTA_INVDUAL",
            "    ,DISP.FTN_NSS",
            "    ,DISP.FTC_CURP",
            "    ,DISP.FTF_MONTO_PESOS",
            "    ,DISP.FTF_MONTO_ACCIONES",
            "    ,DISP.FFN_ID_CONCEPTO_MOV",
            "    ,DISP.FNN_ID_VIV_GARANTIA",
            "    ,DISP.FCN_ID_PROCESO",
            "    ,#PARAM@5# FCN_ID_SUBPROCESO",
            "    ,'#PARAM@3#' AS TIPO_MOV",
            "    ,IDNT.FTN_ESTATUS_DIAG",
            "    ,CAST(DECODE('#PARAM@3#','ABONO',0,'CARGO',MSUB.FCN_ID_TIPO_SUBCTA) AS INT) FCN_ID_TIPO_SUBCTA",
            "    ,CMOV.FCN_ID_TIPO_MONTO",
            "FROM CIERREN_ETL.TTSISGRAL_ETL_DISPERSION DISP",
            "INNER JOIN CIERREN_ETL.TTSISGRAL_ETL_VAL_IDENT_CTE IDNT ON (",
            "        DISP.FTN_NUM_CTA_INVDUAL = IDNT.FTN_NUM_CTA_INVDUAL",
            "        AND (",
            "            DISP.FTN_NSS = IDNT.FTN_NSS",
            "            OR DISP.FTC_CURP = IDNT.FTC_CURP",
            "            )",
            "        )",
            "    JOIN CIERREN_ETL.TLSISGRAL_ETL_VAL_MATRIZ_CONV VAL_MT",
            "        ON VAL_MT.FTN_NUM_CTA_INVDUAL = DISP.FTN_NUM_CTA_INVDUAL AND VAL_MT.FTC_FOLIO = '#PARAM@1#' AND VAL_MT.FTB_ESTATUS_MARCA = 0",
            "    JOIN CIERREN.TRAFOGRAL_MOV_SUBCTA MSUB",
            "        ON (MSUB.FCN_ID_TIPO_SUBCTA = DISP.FCN_ID_TIPO_SUBCTA OR CAST(DECODE('#PARAM@3#','ABONO',0,'CARGO',MSUB.FCN_ID_TIPO_SUBCTA) AS INT) = 0) AND MSUB.FRB_VIGENCIA = 1 AND MSUB.FCN_ID_SUBPROCESO = #PARAM@5#",
            "    JOIN CIERREN.TFAFOGRAL_CONFIG_CONCEP_MOV CMOV",
            "        ON DISP.FFN_ID_CONCEPTO_MOV = CMOV.FFN_ID_CONCEPTO_MOV AND CMOV.FRN_ID_MOV_SUBCTA = MSUB.FRN_ID_MOV_SUBCTA AND CMOV.FFB_VIGENCIA = 1",
            "    JOIN CIERREN.TCCRXGRAL_CAT_CATALOGO CAT",
            "        ON '#PARAM@3#' = CAT.FCC_VALOR AND MSUB.FCN_ID_TIPO_MOV = CAT.FCN_ID_CAT_CATALOGO AND CAT.FCB_VIGENCIA = 1",
            "    JOIN CIERREN.TCCRXGRAL_TIPO_CAT TCAT",
            "        ON CAT.FCN_ID_TIPO_CAT = TCAT.FCN_ID_TIPO_CAT AND TCAT.FCN_ID_TIPO_CAT = 25 AND TCAT.FCB_VIGENCIA = 1",
            "WHERE DISP.FTC_FOLIO = DECODE('#PARAM@3#', 'ABONO', '#PARAM@1#', '#PARAM@2#')",
            "AND IDNT.FTC_FOLIO = DECODE('#PARAM@3#', 'ABONO', '#PARAM@1#', '#PARAM@2#')",
            "    AND (",
            "        DISP.FCN_ID_SUBPROCESO IN (8, 121, 439, 9, 118)",
            "        OR (DISP.FCN_ID_SUBPROCESO IN (120, 210, 122, 105))",
            "        AND IDNT.FTN_ESTATUS_DIAG = 1",
            "        )"
          ]
        },
        {
          "step_id" : "005",
          "subprocess" : "MVC",
          "description" : [
            "descripcion - Este query genera la tabla TEMP_DOIMSS_MCV_MONTOS_CLIENTE",
            "#PARAM@1# = Tabla delta"
          ],
          "value": [
            "SELECT",
            "    DCI.FTC_FOLIO",
            "    ,DCI.FCN_ID_PROCESO",
            "    ,DCI.FCN_ID_SUBPROCESO",
            "    ,DCI.FTN_NUM_CTA_INVDUAL",
            "    ,DCI.FCN_ID_TIPO_SUBCTA",
            "    ,sum(DCI.FTF_MONTO) FTN_MONTO",
            "    ,DCI.FTC_FOLIO_REL",
            "    ,DCI.FCN_ID_TIPO_MONTO",
            "FROM (",
            "    SELECT FTC_FOLIO",
            "        ,FCN_ID_PROCESO",
            "        ,FCN_ID_SUBPROCESO",
            "        ,FTN_NUM_CTA_INVDUAL",
            "        ,0 FCN_ID_TIPO_SUBCTA",
            "        ,CASE WHEN FFN_ID_CONCEPTO_MOV IN (637, 638, 1003, 1002) THEN FTF_MONTO_ACCIONES ELSE FTF_MONTO_PESOS END FTF_MONTO",
            "        ,FFN_ID_CONCEPTO_MOV",
            "        ,FTC_FOLIO_REL",
            "        ,TIPO_MOV",
            "        ,FCN_ID_TIPO_MONTO",
            "    FROM #PARAM@1# DCI",
            "    WHERE TIPO_MOV = 'ABONO'",
            "        AND FFN_ID_CONCEPTO_MOV NOT IN (231, 637, 638, 1002, 1003)",
            "    UNION ALL ",
            "    SELECT FTC_FOLIO",
            "        ,FCN_ID_PROCESO",
            "        ,FCN_ID_SUBPROCESO",
            "        ,FTN_NUM_CTA_INVDUAL",
            "        ,FCN_ID_TIPO_SUBCTA",
            "        ,CASE WHEN FFN_ID_CONCEPTO_MOV IN (637, 638, 1003, 1002) THEN FTF_MONTO_ACCIONES ELSE FTF_MONTO_PESOS END FTF_MONTO",
            "        ,FFN_ID_CONCEPTO_MOV",
            "        ,FTC_FOLIO_REL",
            "        ,TIPO_MOV",
            "        ,FCN_ID_TIPO_MONTO",
            "    FROM #PARAM@1# DCI",
            "    WHERE TIPO_MOV = 'CARGO'",
            "        AND FFN_ID_CONCEPTO_MOV IN (231, 637, 638, 1003, 1002)",
            "        AND FNN_ID_VIV_GARANTIA = 1",
            "        AND (",
            "            (",
            "                FFN_ID_CONCEPTO_MOV = 231",
            "                AND FTF_MONTO_PESOS > 0",
            "                ) ",
            "            or ",
            "                (",
            "                FFN_ID_CONCEPTO_MOV  in (637, 638,1003,1002)",
            "                AND FTF_MONTO_ACCIONES > 0",
            "                )",
            "            )",
            ")DCI",
            "GROUP BY",
            "    DCI.FTC_FOLIO",
            "    ,DCI.FCN_ID_PROCESO",
            "    ,DCI.FCN_ID_SUBPROCESO",
            "    ,DCI.FTN_NUM_CTA_INVDUAL",
            "    ,DCI.FCN_ID_TIPO_SUBCTA",
            "    ,DCI.FTC_FOLIO_REL",
            "    ,DCI.FCN_ID_TIPO_MONTO"
          ]
        }
    ]
}