{
  "flow" : "DOIMSS",
  "id" : "5",
  "steps" :
    [
        {
          "step_id" : "001",
          "subprocess" : "MVC",
          "description" : [
            "descripcion - Este query genera la tabla TEMP_DOIMSS_MCV_MONTOS_CLIENTE",
            "#PARAM@1# = #p_SR_FOLIO# = Numero de folio",
            "#PARAM@2# = #p_SR_FOLIO_REL# = Numero de folio",
            "#PARAM@3# = #p_SR_TIPO_MOV# = Tipo de movimiento Cargo o Abono",
            "#PARAM@4# = #p_SR_PROCESO# = Proceso",
            "#PARAM@5# = #p_SR_SUBPROCESO# = Subproceso"
          ],
          "value": [
            "WITH ",
            " TEMP_DISPERSIONES_CLIENTES_IDENTIFICADOS",
            "AS(",
            "    SELECT '#PARAM@1#' FTC_FOLIO",
            "        ,'#PARAM@2#' FTC_FOLIO_REL",
            "        ,DISP.FTN_NUM_CTA_INVDUAL",
            "        ,DISP.FTN_NSS",
            "        ,DISP.FTC_CURP",
            "        ,DISP.FCN_ID_TIPO_SUBCTA FCN_ID_TIPO_SUBCTA",
            "        ,DISP.FTF_MONTO_PESOS",
            "        ,DISP.FTF_MONTO_ACCIONES",
            "        ,DISP.FFN_ID_CONCEPTO_MOV",
            "        ,DISP.FNN_ID_VIV_GARANTIA",
            "        ,DISP.FCN_ID_PROCESO",
            "        ,#PARAM@5# FCN_ID_SUBPROCESO",
            "        ,'#PARAM@3#' AS TIPO_MOV",
            "        ,IDNT.FTN_ESTATUS_DIAG",
            "    FROM CIERREN_ETL.TTSISGRAL_ETL_DISPERSION DISP",
            "    INNER JOIN CIERREN_ETL.TTSISGRAL_ETL_VAL_IDENT_CTE IDNT ON (",
            "            DISP.FTN_NUM_CTA_INVDUAL = IDNT.FTN_NUM_CTA_INVDUAL",
            "            AND (",
            "                DISP.FTN_NSS = IDNT.FTN_NSS",
            "                OR DISP.FTC_CURP = IDNT.FTC_CURP",
            "                )",
            "            )",
            "    WHERE DISP.FTC_FOLIO = DECODE('#PARAM@3#', 'ABONO', '#PARAM@1#', '#PARAM@2#')",
            "    AND IDNT.FTC_FOLIO = DECODE('#PARAM@3#', 'ABONO', '#PARAM@1#', '#PARAM@2#')",
            "        AND (",
            "            DISP.FCN_ID_SUBPROCESO IN (8, 121, 439, 9)",
            "            OR (FCN_ID_SUBPROCESO IN (120, 210, 122, 105))",
            "            AND IDNT.FTN_ESTATUS_DIAG = 1",
            "            )",
            "",
            "),",
            "",
            "TEMP_MAPEO_DISP_CLIENTES_IDENT ",
            "AS",
            "(",
            "SELECT FTC_FOLIO",
            "    ,FCN_ID_PROCESO",
            "    ,FCN_ID_SUBPROCESO",
            "    ,FTN_NUM_CTA_INVDUAL",
            "    ,0 FCN_ID_TIPO_SUBCTA",
            "    ,CASE WHEN FFN_ID_CONCEPTO_MOV IN (637, 638, 1003, 1002) THEN FTF_MONTO_ACCIONES ELSE FTF_MONTO_PESOS END FTF_MONTO",
            "    ,FFN_ID_CONCEPTO_MOV",
            "    ,FTC_FOLIO_REL",
            "    ,TIPO_MOV",
            "FROM TEMP_DISPERSIONES_CLIENTES_IDENTIFICADOS DCI",
            "WHERE TIPO_MOV = 'ABONO'",
            "    AND FFN_ID_CONCEPTO_MOV NOT IN (231, 637, 638, 1002, 1003)",
            "",
            "UNION ALL ",
            "",
            "SELECT FTC_FOLIO",
            "    ,FCN_ID_PROCESO",
            "    ,FCN_ID_SUBPROCESO",
            "    ,FTN_NUM_CTA_INVDUAL",
            "    ,FCN_ID_TIPO_SUBCTA",
            "    ,CASE WHEN FFN_ID_CONCEPTO_MOV IN (637, 638, 1003, 1002) THEN FTF_MONTO_ACCIONES ELSE FTF_MONTO_PESOS END FTF_MONTO",
            "    ,FFN_ID_CONCEPTO_MOV",
            "    ,FTC_FOLIO_REL",
            "    ,TIPO_MOV",
            "FROM TEMP_DISPERSIONES_CLIENTES_IDENTIFICADOS DCI",
            "WHERE TIPO_MOV = 'CARGO'",
            "    AND FFN_ID_CONCEPTO_MOV IN (231, 637, 638, 1003, 1002)",
            "    AND FNN_ID_VIV_GARANTIA = 1",
            "    AND (",
            "        (",
            "            FFN_ID_CONCEPTO_MOV = 231",
            "            AND FTF_MONTO_PESOS > 0",
            "            ) ",
            "        or ",
            "            (",
            "            FFN_ID_CONCEPTO_MOV  in (637, 638,1003,1002)",
            "            AND FTF_MONTO_ACCIONES > 0",
            "            )",
            ")",
            ")",
            "SELECT  ",
            "DCI.FTC_FOLIO",
            "    ,DCI.FCN_ID_PROCESO",
            "    ,DCI.FCN_ID_SUBPROCESO",
            "    ,DCI.FTN_NUM_CTA_INVDUAL",
            "    ,CAST(DECODE('#PARAM@3#','ABONO',0,'CARGO',MSUB.FCN_ID_TIPO_SUBCTA) AS INT) FCN_ID_TIPO_SUBCTA",
            "    ,sum(DCI.FTF_MONTO) FTN_MONTO",
            "    ,DCI.FTC_FOLIO_REL",
            "    ,CMOV.FCN_ID_TIPO_MONTO",
            "FROM   CIERREN.TFAFOGRAL_CONFIG_CONCEP_MOV CMOV ",
            "       INNER JOIN CIERREN.TRAFOGRAL_MOV_SUBCTA MSUB",
            "           ON CMOV.FRN_ID_MOV_SUBCTA = MSUB.FRN_ID_MOV_SUBCTA",
            "       INNER JOIN CIERREN.TCCRXGRAL_CAT_CATALOGO CAT",
            "           ON MSUB.FCN_ID_TIPO_MOV = CAT.FCN_ID_CAT_CATALOGO",
            "       INNER JOIN CIERREN.TCCRXGRAL_TIPO_CAT TCAT",
            "           ON CAT.FCN_ID_TIPO_CAT = TCAT.FCN_ID_TIPO_CAT",
            " inner join TEMP_MAPEO_DISP_CLIENTES_IDENT DCI ON (",
            " (MSUB.FCN_ID_TIPO_SUBCTA = DCI.FCN_ID_TIPO_SUBCTA ",
            " OR DCI.FCN_ID_TIPO_SUBCTA = 0)",
            "        AND DCI.FCN_ID_SUBPROCESO = MSUB.FCN_ID_SUBPROCESO",
            "   AND DCI.FFN_ID_CONCEPTO_MOV = CMOV.FFN_ID_CONCEPTO_MOV",
            "        AND DCI.TIPO_MOV = CAT.FCC_VALOR",
            "        )",
            "WHERE  CMOV.FFB_VIGENCIA = 1",
            "AND    MSUB.FRB_VIGENCIA = 1",
            "AND    MSUB.FCN_ID_SUBPROCESO = #PARAM@5#",
            "AND    TCAT.FCN_ID_TIPO_CAT = 25",
            "AND    TCAT.FCB_VIGENCIA = 1",
            "AND    CAT.FCB_VIGENCIA = 1",
            "GROUP BY DCI.FTN_NUM_CTA_INVDUAL",
            "    ,DCI.FTC_FOLIO",
            "    ,DCI.FTC_FOLIO_REL",
            "    ,DECODE('#PARAM@3#','ABONO',0,'CARGO',MSUB.FCN_ID_TIPO_SUBCTA)",
            "    ,DCI.FCN_ID_PROCESO",
            "    ,DCI.FCN_ID_SUBPROCESO",
            "    ,CMOV.FCN_ID_TIPO_MONTO"
          ]
        },
         {
          "step_id" : "002",
          "subprocess" : "MVC",
          "description" : [
            "#PARAM@1# = #p_SR_FOLIO# = Numero de folio"
          ],
          "value": [
            "SELECT DISTINCT lpad(to_number(to_char(MAT.FTN_NUM_CTA_INVDUAL)), 10, '0') FTN_NUM_CTA_INVDUAL",
            "    ,MAT.TCN_TIPO_SALDO_OPERA",
            "    ,MAT.FRN_ID_MOV_SUBCTA",
            "    ,FOL.FCN_ID_SUBPROCESO FCN_ID_SUBPROCESO_CON",
            "FROM CIERREN.TTAFOGRAL_MATRIZ_CONVIVENCIA MAT",
            "INNER JOIN CIERREN.TTCRXGRAL_FOLIO FOL ON MAT.FTC_FOLIO = FOL.FTC_FOLIO",
            "WHERE MAT.FTB_ESTATUS_MARCA = '1'"
          ]
        },
        {
            "step_id" : "003",
            "subprocess" : "MVC",
            "description" : [
               "descripcion - Este query hace un left join entre TEMP_DOIMSS_MCV_MONTOS_CLIENTE y DF_Job030_01 para generar la tabla TEMP_VALIDA_DISP_MATRIZ",
               "#PARAM@1# = #p_SR_FOLIO# = Numero de folio"
            ],
            "value": [
              "SELECT MDCI.FTN_NUM_CTA_INVDUAL",
              "    ,MDCI.FTC_FOLIO",
              "    ,MDCI.FTC_FOLIO_REL",
              "    ,MDCI.FCN_ID_PROCESO",
              "    ,MDCI.FCN_ID_SUBPROCESO",
              "    ,MDCI.FCN_ID_TIPO_SUBCTA",
              "    ,MDCI.FCN_ID_TIPO_MONTO",
              "    ,MDCI.FTN_MONTO FTF_MONTO",
              "    ,MATRIZ.TCN_TIPO_SALDO_OPERA",
              "    ,MATRIZ.FRN_ID_MOV_SUBCTA",
              "    ,MATRIZ.FCN_ID_SUBPROCESO_CON",
              "FROM #PARAM@2#.#PARAM@3#.TEMP_DOIMSS_MCV_MONTOS_CLIENTE_#PARAM@1# MDCI",
              "LEFT JOIN #PARAM@2#.#PARAM@3#.DF_Job030_01_#PARAM@1# MATRIZ ON MDCI.FTN_NUM_CTA_INVDUAL = MATRIZ.FTN_NUM_CTA_INVDUAL"
            ]
        },
        {
            "step_id" : "004",
            "subprocess" : "MVC",
            "description" : [
               "descripcion - Este query obtiene la configuración de la convivencia"
            ],
            "value": [
              "SELECT FFB_CONVIVENCIA",
              "        ,FCN_ID_SUBPROCESO",
              "        ,FCN_ID_SUBPROCESO_CON",
              "    FROM CIERREN.TFAFOGRAL_CONFIG_CONVIV",
              "    WHERE FFB_VIGENTE = 1"
            ]
        },
        {
            "step_id" : "005",
            "subprocess" : "MVC",
            "description" : [
               "descripcion - Query que genera la Tabla TEMP_VAL_MATRIZ  "
            ],
            "value":
            [
                "SELECT "
                ,"    FTN_NUM_CTA_INVDUAL,"
                ,"    FTC_FOLIO,"
                ,"    FTC_FOLIO_REL,"
                ,"    FCN_ID_PROCESO,"
                ,"    VDM.FCN_ID_SUBPROCESO,"
                ,"    FCN_ID_TIPO_SUBCTA,"
                ,"    FCN_ID_TIPO_MONTO,"
                ,"    FTF_MONTO,"
                ,"    CONF_CONV.FCN_ID_SUBPROCESO_CON FTN_ID_SUBPROC_NO_CONV,"
                ,"    CONF_CONV.FFB_CONVIVENCIA,"
                ,"    NULL FTB_ESTATUS_MARCA,"
                ,"    NULL FTN_ID_ERROR_VAL"
                ,"FROM "
                ,"    #PARAM@2#.#PARAM@3#.TEMP_VALIDA_DISP_MATRIZ_#PARAM@1# VDM"
                ,"LEFT JOIN "
                ,"    #PARAM@2#.#PARAM@3#.DF_Job030_02_#PARAM@1# CONF_CONV "
                ,"    ON ("
                ,"        CONF_CONV.FCN_ID_SUBPROCESO = VDM.FCN_ID_SUBPROCESO"
                ,"        AND CONF_CONV.FCN_ID_SUBPROCESO_CON = VDM.FCN_ID_SUBPROCESO_CON"
                ,"    )"
                ,"WHERE "
                ,"    VDM.FCN_ID_SUBPROCESO_CON IS NOT NULL"
                ,"UNION ALL"
                ,"SELECT "
                ,"    FTN_NUM_CTA_INVDUAL,"
                ,"    FTC_FOLIO,"
                ,"    FTC_FOLIO_REL,"
                ,"    FCN_ID_PROCESO,"
                ,"    FCN_ID_SUBPROCESO,"
                ,"    FCN_ID_TIPO_SUBCTA,"
                ,"    FCN_ID_TIPO_MONTO,"
                ,"    FTF_MONTO,"
                ,"    NULL FTN_ID_SUBPROC_NO_CONV,"
                ,"    '*' FFB_CONVIVENCIA,"
                ,"    1 FTB_ESTATUS_MARCA,"
                ,"    NULL FTN_ID_ERROR_VAL"
                ,"FROM "
                ,"    #PARAM@2#.#PARAM@3#.TEMP_VALIDA_DISP_MATRIZ_#PARAM@1# VDM"
                ,"WHERE "
                ,"    VDM.FCN_ID_SUBPROCESO_CON IS NULL;"
            ]
          },
                  {
            "step_id" : "006",
            "subprocess" : "MVC",
            "description" : [
               "descripcion - Este query obtiene los registros a insertar en tabla TLSISGRAL_ETL_VAL_MATRIZ_CONV",
               "#PARAM@1# = #p_SR_TIPO_MOV# = Tipo de Movimiento"
            ],
            "value": [
              "SELECT",
              "  FTN_NUM_CTA_INVDUAL,",
              "  FTC_FOLIO,",
              "  FTC_FOLIO_REL,",
              "  FCN_ID_PROCESO,",
              "  FCN_ID_SUBPROCESO,",
              "  FCN_ID_TIPO_SUBCTA,",
              "  CASE WHEN '#PARAM@1#' = 'ABONO' THEN NULL ELSE FCN_ID_TIPO_MONTO END FCN_ID_TIPO_MONTO,",
              "  CASE WHEN '#PARAM@1#' = 'ABONO' THEN NULL ELSE FTF_MONTO END FTF_MONTO,",
              "  CASE WHEN FFB_CONVIVENCIA = '*' THEN FTB_ESTATUS_MARCA",
              "       WHEN FFB_CONVIVENCIA = '1' OR FFB_CONVIVENCIA IS NULL THEN 1",
              "       ELSE 0 END FTC_ESTATUS_MARCA,",
              "  CASE WHEN FFB_CONVIVENCIA = '*' THEN NULL",
              "       WHEN FFB_CONVIVENCIA = '1' OR FFB_CONVIVENCIA IS NULL THEN NULL",
              "       ELSE FTN_ID_SUBPROC_NO_CONV END FTN_ID_SUBPROC_NO_CONV,",
              "  CASE WHEN FFB_CONVIVENCIA = '*' THEN NULL",
              "       WHEN FFB_CONVIVENCIA = '1' OR FFB_CONVIVENCIA IS NULL THEN NULL",
              "       ELSE 421 END FTN_ID_ERROR_VAL,",
              "  to_timestamp(from_utc_timestamp(current_timestamp, 'GMT-6')) FTD_FECHA",
              "FROM #PARAM@2#.#PARAM@3#.TEMP_VAL_MATRIZ_#PARAM@4#"
            ]
        },
                {
            "step_id" : "007",
            "subprocess" : "MVC",
            "description" : [
            "descripcion - Este query genera la tabla Matriz_Conv que se utilizará para insertar en CIERREN_ETL.TLSISGRAL_ETL_VAL_MATRIZ_CONV",
            "#PARAM@1# = #p_SR_FOLIO# = Numero de folio",
            "#PARAM@2# = #p_SR_FOLIO_REL# = Numero de folio",
            "#PARAM@3# = #p_SR_TIPO_MOV# = Tipo de movimiento Cargo o Abono",
            "#PARAM@4# = #p_SR_PROCESO# = Proceso",
            "#PARAM@5# = #p_SR_SUBPROCESO# = Subproceso"
            ],
            "value": [
                "SELECT VLMC.FTC_FOLIO",
                "    ,VLMC.FTC_FOLIO_REL",
                "    ,VLMC.FTN_NUM_CTA_INVDUAL",
                "    ,VLMC.FTF_MONTO FTN_MONTO",
                "    ,VLMC.FCN_ID_TIPO_MONTO",
                "    ,VLMC.FTB_ESTATUS_MARCA FTC_ESTATUS_MARCA",
                "    ,VLMC.FTN_ID_MARCA",
                "    ,SCTA.FRN_ID_MOV_SUBCTA",
                "    ,CONFIG_SUBP.FCN_ID_SALDO_OPERA AS FCN_TIPO_SALDO_OPERA",
                "    ,sysdate FTD_FEH_CRE",
                "    ,'#PARAM@6#' FCC_USU_CRE",
                "    ,sysdate FTD_FEH_ACT",
                "    ,'#PARAM@6#' FCC_USU_ACT",
                "FROM CIERREN_ETL.TLSISGRAL_ETL_VAL_MATRIZ_CONV VLMC",
                "LEFT JOIN (",
                "    SELECT SCTA.FRN_ID_MOV_SUBCTA",
                "        ,SCTA.FCN_ID_SUBPROCESO",
                "        ,SCTA.FCN_ID_TIPO_SUBCTA",
                "        ,CAT.FCC_VALOR AS TIPO_MOV",
                "    FROM CIERREN.TRAFOGRAL_MOV_SUBCTA SCTA",
                "        ,CIERREN.TCCRXGRAL_CAT_CATALOGO CAT",
                "        ,CIERREN.TCCRXGRAL_TIPO_CAT TCAT",
                "    WHERE SCTA.FCN_ID_TIPO_MOV = CAT.FCN_ID_CAT_CATALOGO",
                "        AND CAT.FCN_ID_TIPO_CAT = TCAT.FCN_ID_TIPO_CAT",
                "        AND TCAT.FCN_ID_TIPO_CAT = 25",
                "        AND TCAT.FCB_VIGENCIA = 1",
                "        AND CAT.FCB_VIGENCIA = 1",
                "        AND SCTA.FRB_VIGENCIA = 1",
                "    ) SCTA",
                "    ON (",
                "            VLMC.FCN_ID_SUBPROCESO = SCTA.FCN_ID_SUBPROCESO",
                "            AND VLMC.FCN_ID_TIPO_SUBCTA = SCTA.FCN_ID_TIPO_SUBCTA",
                "            AND SCTA.TIPO_MOV = '#PARAM@3#'",
                "            )",
                "LEFT JOIN (",
                "    SELECT FCN_ID_PROCESO",
                "        ,FCN_ID_SUBPROCESO",
                "        ,FCN_ID_SALDO_OPERA",
                "    FROM CIERREN.TFAFOGRAL_CONFIG_SUBPROCESO",
                "    ) CONFIG_SUBP",
                "    ON (",
                "            VLMC.FCN_ID_PROCESO = CONFIG_SUBP.FCN_ID_PROCESO",
                "            AND VLMC.FCN_ID_SUBPROCESO = CONFIG_SUBP.FCN_ID_SUBPROCESO",
                "            )",
                "WHERE VLMC.FTB_ESTATUS_MARCA = 1",
                "    AND VLMC.FTC_FOLIO = '#PARAM@1#'",
                "    AND (",
                "        decode(VLMC.FTC_FOLIO_REL, NULL, '-1', VLMC.FTC_FOLIO_REL) = decode('#PARAM@2#', '', '-1', '#PARAM@2#')",
                "        OR decode(#PARAM@5#, '101', '-1') = decode(#PARAM@5#, '101', '-1')",
                "        )",
                "    AND VLMC.FCN_ID_PROCESO = #PARAM@4#",
                "    AND VLMC.FCN_ID_SUBPROCESO = #PARAM@5#"
            ]
        },

                {
            "step_id" : "008",
            "subprocess" : "MVC",
            "description" : [
               "descripcion - Este query obtiene los datos que serán insertados en las tablas de Cifras Control",
            "#PARAM@1# = #p_SR_FOLIO# = Numero de folio",
            "#PARAM@2# = #p_SR_FOLIO_REL# = Numero de folio",
            "#PARAM@3# = #p_SR_PROCESO# = Proceso",
            "#PARAM@4# = #p_SR_SUBPROCESO# = Subproceso",
            "#PARAM@5# = #p_Usuario_BD# = Usuario",
            "#PARAM@6# = #p_Usuario_BD# = Usuario"
            ],
            "value": [
              "SELECT ",
              "    FTC_FOLIO",
              "    ,FTC_FOLIO_REL",
              "    ,SUM(TOT_REG) FLN_TOTAL_REGISTROS",
              "    ,SUM(TOT_NC) FLN_REG_NO_CUMPLIERON",
              "    ,SUM(TOT_SC) FLN_REG_CUMPLIERON",
              "    ,SUM(FLN_TOTAL_ERRORES) FLN_TOTAL_ERRORES",
              "    ,FTD_FECHA FLD_FEC_REG",
              "    ,#PARAM@6# FTC_ID_SUBETAPA",
              "    ,'0' FLC_DETALLE",
              "    ,201 FLC_VALIDACION",
              "    ,NULL FTN_ID_ARCHIVO",
              "    ,'#PARAM@5#' FLC_USU_REG",
              "FROM (",
              "    SELECT FTC_FOLIO",
              "        ,FTC_FOLIO_REL",
              "        ,FCN_ID_PROCESO",
              "        ,FCN_ID_SUBPROCESO",
              "        ,FTN_NUM_CTA_INVDUAL",
              "        ,SYSDATE FTD_FECHA",
              "        ,1 TOT_REG",
              "        ,DECODE(MIN(FTB_ESTATUS_MARCA), 0, 1, 0) TOT_NC",
              "        ,DECODE(MIN(FTB_ESTATUS_MARCA), 1, 1, 2, 1, 0) TOT_SC",
              "        ,0 FLN_TOTAL_ERRORES",
              "    FROM CIERREN_ETL.TLSISGRAL_ETL_VAL_MATRIZ_CONV nc",
              "    WHERE ",
              "        FTC_FOLIO = #PARAM@1#",
              "        AND DECODE(FTC_FOLIO_REL, NULL, '-1', FTC_FOLIO_REL) = DECODE('#PARAM@2#', '', '-1', '#PARAM@2#')",
              "        AND FCN_ID_PROCESO = #PARAM@3#",
              "        AND FCN_ID_SUBPROCESO = #PARAM@4#",
              "    GROUP BY FTC_FOLIO",
              "        ,FTC_FOLIO_REL",
              "        ,FCN_ID_PROCESO",
              "        ,FCN_ID_SUBPROCESO",
              "        ,FTN_NUM_CTA_INVDUAL",
              "    ) A",
              "GROUP BY FTC_FOLIO",
              "    ,FTC_FOLIO_REL",
              "    ,FCN_ID_PROCESO",
              "    ,FCN_ID_SUBPROCESO",
              "    ,FTD_FECHA"
            ]
        },
                {
            "step_id" : "009",
            "subprocess" : "MVC",
            "description" : [
            "descripcion - Este query genera el archivo de errores #p_SR_FOLIO##p_SR_FOLIO_REL##p_SR_TIPO_MOV#_Matriz_Convivencia.csv",
            "#PARAM@1# = #p_SR_FOLIO# = Numero de folio",
            "#PARAM@2# = #p_SR_FOLIO_REL# = Numero de folio",
            "#PARAM@3# = #p_SR_PROCESO# = Proceso",
            "#PARAM@4# = #p_SR_SUBPROCESO# = Subproceso",
            "#PARAM@5# = #TIPO_MOV# = Tipo de movimiento --> Abono o Cargo"
            ],
            "value": [
              "With VAL_MAT AS( ",
              "SELECT VAL_MCV.FTN_NUM_CTA_INVDUAL",
              "    ,TO_CHAR(VAL_MCV.FCN_ID_TIPO_SUBCTA) AS SUBCUENTA",
              "    ,TTSISGRAL.FTN_NSS",
              "    ,TTSISGRAL.FTC_CURP",
              "    ,TTSISGRAL.FTC_NOMBRE_CTE AS FTC_NOMBRE",
              "    ,(CASE WHEN VAL_MCV.FTN_ID_ERROR_VAL = '421' THEN 279 WHEN VAL_MCV.FTN_ID_ERROR_VAL = '282' THEN 280 WHEN VAL_MCV.FTN_ID_ERROR_VAL = '283' THEN 281 END) AS COD_VALIDACION",
              "    ,TCCRXGRAL.FCC_VALOR AS MOTIVO_NO_CONVIV",
              "FROM CIERREN_ETL.TLSISGRAL_ETL_VAL_MATRIZ_CONV VAL_MCV",
              "LEFT JOIN CIERREN.TCCRXGRAL_CAT_CATALOGO CAT ON VAL_MCV.FTN_ID_ERROR_VAL = CAT.FCN_ID_CAT_CATALOGO",
              "LEFT JOIN CIERREN.TCCRXGRAL_TIPO_CAT TC ON CAT.FCN_ID_TIPO_CAT = TC.FCN_ID_TIPO_CAT",
              "LEFT JOIN CIERREN_ETL.TTSISGRAL_ETL_VAL_IDENT_CTE TTSISGRAL ON VAL_MCV.FTN_NUM_CTA_INVDUAL = TTSISGRAL.FTN_NUM_CTA_INVDUAL",
              "LEFT JOIN CIERREN.TCCRXGRAL_CAT_CATALOGO TCCRXGRAL ON VAL_MCV.FTN_ID_SUBPROC_NO_CONV = TCCRXGRAL.FCN_ID_CAT_CATALOGO",
              "WHERE VAL_MCV.FTB_ESTATUS_MARCA = 0",
              "    AND VAL_MCV.FTC_FOLIO = #PARAM@1#",
              "    AND decode(VAL_MCV.FTC_FOLIO_REL, NULL, '-1', VAL_MCV.FTC_FOLIO_REL) = decode('#PARAM@2#', '', '-1', '#PARAM@2#')",
              "    AND VAL_MCV.FCN_ID_PROCESO = #PARAM@3#",
              "    AND VAL_MCV.FCN_ID_SUBPROCESO = #PARAM@4#",
              "    AND TC.FCN_ID_TIPO_CAT IN (3, 19, 20, 24, 38)",
              "    AND TC.FCB_VIGENCIA = 1",
              "    AND CAT.FCB_VIGENCIA = 1",
              "    AND TTSISGRAL.FTC_FOLIO = DECODE('#PARAM@5#', 'ABONO', '#PARAM@1#', '#PARAM@2#')",
              ")",
              "    ",
              "SELECT FTN_NUM_CTA_INVDUAL",
              "    ,CASE WHEN SUBCUENTA = '0' THEN '*' ELSE VAL_MAT.SUBCUENTA END AS SUBCUENTA",
              "    ,FTN_NSS",
              "    ,FTC_CURP",
              "    ,FTC_NOMBRE",
              "    ,CAT.FCC_VALOR VALIDACION",
              "    ,MOTIVO_NO_CONVIV",
              "FROM VAL_MAT",
              "LEFT JOIN CIERREN.TCCRXGRAL_CAT_CATALOGO CAT ON VAL_MAT.COD_VALIDACION = CAT.FCN_ID_CAT_CATALOGO"
            ]
        },
                {
            "step_id" : "010",
            "subprocess" : "MVC",
            "description" : [
            "descripcion - Delete en CIERREN_ETL.TLSISGRAL_ETL_VAL_MATRIZ_CONV",
            "#PARAM@1# = #p_SR_FOLIO# = Numero de folio",
            "#PARAM@2# = #p_SR_FOLIO_REL# = Numero de folio",
            "#PARAM@3# = #p_SR_PROCESO# = Proceso",
            "#PARAM@4# = #p_SR_SUBPROCESO# = Subproceso"
            ],
            "value": [
              "DELETE CIERREN_ETL.TLSISGRAL_ETL_VAL_MATRIZ_CONV WHERE FTB_ESTATUS_MARCA = 0 AND FTC_FOLIO = '#PARAM@1#'"
            ]
        },
{
            "step_id" : "011",
            "subprocess" : "MVC",
            "description" : [
            "descripcion - Delete en CIERREN.TTAFOGRAL_MATRIZ_CONVIVENCIA",
            "#PARAM@1# = #p_SR_FOLIO# = Numero de folio",
            "#PARAM@2# = #p_SR_FOLIO_REL# = Numero de folio",
            "#PARAM@3# = #p_SR_PROCESO# = Proceso",
            "#PARAM@4# = #p_SR_SUBPROCESO# = Subproceso"
            ],
            "value": [
              "DELETE CIERREN.TTAFOGRAL_MATRIZ_CONVIVENCIA WHERE FTB_ESTATUS_MARCA = 0 AND FTC_FOLIO = '#PARAM@1#'"
            ]
        },
{
            "step_id" : "012",
            "subprocess" : "MVC",
            "description" : [
            "descripcion - UPDATE/INSERT (MERGE) CIERREN.TTAFOGRAL_MATRIZ_CONVIVENCIA",
            "#PARAM@1# = #p_SR_FOLIO# = Numero de folio",
            "#PARAM@2# = #p_SR_FOLIO_REL# = Numero de folio",
            "#PARAM@3# = #p_SR_PROCESO# = Proceso",
            "#PARAM@4# = #p_SR_SUBPROCESO# = Subproceso"
            ],
            "value": [
              "MERGE INTO CIERREN.TTAFOGRAL_MATRIZ_CONVIVENCIA ori",
              "USING (",
              "    SELECT FTN_ID_MARCA",
              "        ,FTC_FOLIO",
              "        ,FTC_FOLIO_REL",
              "        ,FTN_NUM_CTA_INVDUAL",
              "        ,FCN_TIPO_SALDO_OPERA",
              "        ,FCN_ID_TIPO_MONTO",
              "        ,FRN_ID_MOV_SUBCTA",
              "        ,FTN_MONTO",
              "        ,FTC_ESTATUS_MARCA",
              "        ,FTD_FEH_CRE",
              "        ,FCC_USU_CRE",
              "        ,FTD_FEH_ACT",
              "        ,FCC_USU_ACT",
              "    FROM CIERREN_DATAUX.TTAFOGRAL_ETL_MATRIZ_CONVIVENCIA_AUX where FTC_FOLIO = '#PARAM@1#'",
              "    ) aux",
              "    ON (ori.FTN_ID_MARCA = aux.FTN_ID_MARCA)",
              "WHEN MATCHED",
              "    THEN",
              "        UPDATE",
              "        SET ori.FTC_FOLIO = aux.FTC_FOLIO",
              "            ,ori.FTC_FOLIO_REL = aux.FTC_FOLIO_REL",
              "            ,ori.FTN_NUM_CTA_INVDUAL = aux.FTN_NUM_CTA_INVDUAL",
              "            ,ori.TCN_TIPO_SALDO_OPERA = aux.FCN_TIPO_SALDO_OPERA",
              "            ,ori.FCN_ID_TIPO_MONTO = aux.FCN_ID_TIPO_MONTO",
              "            ,ori.FRN_ID_MOV_SUBCTA = aux.FRN_ID_MOV_SUBCTA",
              "            ,ori.FTF_MONTO = aux.FTN_MONTO",
              "            ,ori.FTB_ESTATUS_MARCA = aux.FTC_ESTATUS_MARCA",
              "            ,ori.FTD_FEH_ACT = aux.FTD_FEH_ACT",
              "            ,ori.FCC_USU_ACT = aux.FCC_USU_ACT",
              "WHEN NOT MATCHED",
              "    THEN",
              "        INSERT (",
              "            ori.FTN_ID_MARCA",
              "            ,ori.FTC_FOLIO",
              "            ,ori.FTC_FOLIO_REL",
              "            ,ori.FTN_NUM_CTA_INVDUAL",
              "            ,ori.TCN_TIPO_SALDO_OPERA",
              "            ,ori.FCN_ID_TIPO_MONTO",
              "            ,ori.FRN_ID_MOV_SUBCTA",
              "            ,ori.FTF_MONTO",
              "            ,ori.FTB_ESTATUS_MARCA",
              "            ,ori.FTD_FEH_CRE",
              "            ,ori.FCC_USU_CRE",
              "            ,ori.FTD_FEH_ACT",
              "            ,ori.FCC_USU_ACT",
              "            )",
              "        VALUES (",
              "            aux.FTN_ID_MARCA",
              "            ,aux.FTC_FOLIO",
              "            ,aux.FTC_FOLIO_REL",
              "            ,aux.FTN_NUM_CTA_INVDUAL",
              "            ,aux.FCN_TIPO_SALDO_OPERA",
              "            ,aux.FCN_ID_TIPO_MONTO",
              "            ,aux.FRN_ID_MOV_SUBCTA",
              "            ,aux.FTN_MONTO",
              "            ,aux.FTC_ESTATUS_MARCA",
              "            ,aux.FTD_FEH_CRE",
              "            ,aux.FCC_USU_CRE",
              "            ,aux.FTD_FEH_ACT",
              "            ,aux.FCC_USU_ACT",
              "            )"
            ]
        },
        {
          "step_id" : "013",
          "subprocess" : "MVC",
          "description" : [
            "descripcion - Este query genera la tabla TEMP_DOIMSS_MCV_MONTOS_CLIENTE",
            "#PARAM@1# = #p_SR_FOLIO# = Numero de folio",
            "#PARAM@2# = #p_SR_FOLIO_REL# = Numero de folio",
            "#PARAM@3# = #p_SR_TIPO_MOV# = Tipo de movimiento Cargo o Abono",
            "#PARAM@4# = #p_SR_PROCESO# = Proceso",
            "#PARAM@5# = #p_SR_SUBPROCESO# = Subproceso"
          ],
          "value": [
            "INSERT INTO CIERREN_DATAUX.TTSISGRAL_ETL_MONTOS_CLIENTE_AUX",
            "WITH ",
            " TEMP_DISPERSIONES_CLIENTES_IDENTIFICADOS",
            "AS(",
            "    SELECT '#PARAM@1#' FTC_FOLIO",
            "        ,'#PARAM@2#' FTC_FOLIO_REL",
            "        ,DISP.FTN_NUM_CTA_INVDUAL",
            "        ,DISP.FTN_NSS",
            "        ,DISP.FTC_CURP",
            "        ,DISP.FCN_ID_TIPO_SUBCTA FCN_ID_TIPO_SUBCTA",
            "        ,DISP.FTF_MONTO_PESOS",
            "        ,DISP.FTF_MONTO_ACCIONES",
            "        ,DISP.FFN_ID_CONCEPTO_MOV",
            "        ,DISP.FNN_ID_VIV_GARANTIA",
            "        ,DISP.FCN_ID_PROCESO",
            "        ,#PARAM@5# FCN_ID_SUBPROCESO",
            "        ,'#PARAM@3#' AS TIPO_MOV",
            "        ,IDNT.FTN_ESTATUS_DIAG",
            "    FROM CIERREN_ETL.TTSISGRAL_ETL_DISPERSION DISP",
            "    INNER JOIN CIERREN_ETL.TTSISGRAL_ETL_VAL_IDENT_CTE IDNT ON (",
            "            DISP.FTN_NUM_CTA_INVDUAL = IDNT.FTN_NUM_CTA_INVDUAL",
            "            AND (",
            "                DISP.FTN_NSS = IDNT.FTN_NSS",
            "                OR DISP.FTC_CURP = IDNT.FTC_CURP",
            "                )",
            "            )",
            "    WHERE DISP.FTC_FOLIO = DECODE('#PARAM@3#', 'ABONO', '#PARAM@1#', '#PARAM@2#')",
            "    AND IDNT.FTC_FOLIO = DECODE('#PARAM@3#', 'ABONO', '#PARAM@1#', '#PARAM@2#')",
            "        AND (",
            "            DISP.FCN_ID_SUBPROCESO IN (8, 121, 439, 9)",
            "            OR (FCN_ID_SUBPROCESO IN (120, 210, 122, 105))",
            "            AND IDNT.FTN_ESTATUS_DIAG = 1",
            "            )",
            "",
            "),",
            "",
            "TEMP_MAPEO_DISP_CLIENTES_IDENT ",
            "AS",
            "(",
            "SELECT FTC_FOLIO",
            "    ,FCN_ID_PROCESO",
            "    ,FCN_ID_SUBPROCESO",
            "    ,FTN_NUM_CTA_INVDUAL",
            "    ,0 FCN_ID_TIPO_SUBCTA",
            "    ,CASE WHEN FFN_ID_CONCEPTO_MOV IN (637, 638, 1003, 1002) THEN FTF_MONTO_ACCIONES ELSE FTF_MONTO_PESOS END FTF_MONTO",
            "    ,FFN_ID_CONCEPTO_MOV",
            "    ,FTC_FOLIO_REL",
            "    ,TIPO_MOV",
            "FROM TEMP_DISPERSIONES_CLIENTES_IDENTIFICADOS DCI",
            "WHERE TIPO_MOV = 'ABONO'",
            "    AND FFN_ID_CONCEPTO_MOV NOT IN (231, 637, 638, 1002, 1003)",
            "",
            "UNION ALL ",
            "",
            "SELECT FTC_FOLIO",
            "    ,FCN_ID_PROCESO",
            "    ,FCN_ID_SUBPROCESO",
            "    ,FTN_NUM_CTA_INVDUAL",
            "    ,FCN_ID_TIPO_SUBCTA",
            "    ,CASE WHEN FFN_ID_CONCEPTO_MOV IN (637, 638, 1003, 1002) THEN FTF_MONTO_ACCIONES ELSE FTF_MONTO_PESOS END FTF_MONTO",
            "    ,FFN_ID_CONCEPTO_MOV",
            "    ,FTC_FOLIO_REL",
            "    ,TIPO_MOV",
            "FROM TEMP_DISPERSIONES_CLIENTES_IDENTIFICADOS DCI",
            "WHERE TIPO_MOV = 'CARGO'",
            "    AND FFN_ID_CONCEPTO_MOV IN (231, 637, 638, 1003, 1002)",
            "    AND FNN_ID_VIV_GARANTIA = 1",
            "    AND (",
            "        (",
            "            FFN_ID_CONCEPTO_MOV = 231",
            "            AND FTF_MONTO_PESOS > 0",
            "            ) ",
            "        or ",
            "            (",
            "            FFN_ID_CONCEPTO_MOV  in (637, 638,1003,1002)",
            "            AND FTF_MONTO_ACCIONES > 0",
            "            )",
            ")",
            ")",
            "SELECT  ",
            "DCI.FTC_FOLIO",
            "    ,DCI.FCN_ID_PROCESO",
            "    ,DCI.FCN_ID_SUBPROCESO",
            "    ,DCI.FTN_NUM_CTA_INVDUAL",
            "    ,CAST(DECODE('#PARAM@3#','ABONO',0,'CARGO',MSUB.FCN_ID_TIPO_SUBCTA) AS INT) FCN_ID_TIPO_SUBCTA",
            "    ,sum(DCI.FTF_MONTO) FTN_MONTO",
            "    ,DCI.FTC_FOLIO_REL",
            "    ,CMOV.FCN_ID_TIPO_MONTO",
            "FROM   CIERREN.TFAFOGRAL_CONFIG_CONCEP_MOV CMOV ",
            "       INNER JOIN CIERREN.TRAFOGRAL_MOV_SUBCTA MSUB",
            "           ON CMOV.FRN_ID_MOV_SUBCTA = MSUB.FRN_ID_MOV_SUBCTA",
            "       INNER JOIN CIERREN.TCCRXGRAL_CAT_CATALOGO CAT",
            "           ON MSUB.FCN_ID_TIPO_MOV = CAT.FCN_ID_CAT_CATALOGO",
            "       INNER JOIN CIERREN.TCCRXGRAL_TIPO_CAT TCAT",
            "           ON CAT.FCN_ID_TIPO_CAT = TCAT.FCN_ID_TIPO_CAT",
            " inner join TEMP_MAPEO_DISP_CLIENTES_IDENT DCI ON (",
            " (MSUB.FCN_ID_TIPO_SUBCTA = DCI.FCN_ID_TIPO_SUBCTA ",
            " OR DCI.FCN_ID_TIPO_SUBCTA = 0)",
            "        AND DCI.FCN_ID_SUBPROCESO = MSUB.FCN_ID_SUBPROCESO",
            "   AND DCI.FFN_ID_CONCEPTO_MOV = CMOV.FFN_ID_CONCEPTO_MOV",
            "        AND DCI.TIPO_MOV = CAT.FCC_VALOR",
            "        )",
            "WHERE  CMOV.FFB_VIGENCIA = 1",
            "AND    MSUB.FRB_VIGENCIA = 1",
            "AND    MSUB.FCN_ID_SUBPROCESO = #PARAM@5#",
            "AND    TCAT.FCN_ID_TIPO_CAT = 25",
            "AND    TCAT.FCB_VIGENCIA = 1",
            "AND    CAT.FCB_VIGENCIA = 1",
            "GROUP BY DCI.FTN_NUM_CTA_INVDUAL",
            "    ,DCI.FTC_FOLIO",
            "    ,DCI.FTC_FOLIO_REL",
            "    ,DECODE('#PARAM@3#','ABONO',0,'CARGO',MSUB.FCN_ID_TIPO_SUBCTA)",
            "    ,DCI.FCN_ID_PROCESO",
            "    ,DCI.FCN_ID_SUBPROCESO",
            "    ,CMOV.FCN_ID_TIPO_MONTO"
          ]
        },
        {
          "step_id" : "014",
          "subprocess" : "MVC",
          "description" : [
            "descripcion - Este query genera la tabla TEMP_DOIMSS_MCV_MONTOS_CLIENTE",
            "#PARAM@1# = #p_SR_FOLIO# = Numero de folio",
            "#PARAM@2# = #p_SR_FOLIO_REL# = Numero de folio",
            "#PARAM@3# = #p_SR_TIPO_MOV# = Tipo de movimiento Cargo o Abono",
            "#PARAM@4# = #p_SR_PROCESO# = Proceso",
            "#PARAM@5# = #p_SR_SUBPROCESO# = Subproceso"
          ],
          "value": [
            "SELECT '#PARAM@1#' FTC_FOLIO",
            "    ,'#PARAM@2#' FTC_FOLIO_REL",
            "    ,DISP.FTN_NUM_CTA_INVDUAL",
            "    ,DISP.FTN_NSS",
            "    ,DISP.FTC_CURP",
            "    ,DISP.FTF_MONTO_PESOS",
            "    ,DISP.FTF_MONTO_ACCIONES",
            "    ,DISP.FFN_ID_CONCEPTO_MOV",
            "    ,DISP.FNN_ID_VIV_GARANTIA",
            "    ,DISP.FCN_ID_PROCESO",
            "    ,#PARAM@5# FCN_ID_SUBPROCESO",
            "    ,'#PARAM@3#' AS TIPO_MOV",
            "    ,IDNT.FTN_ESTATUS_DIAG",
            "    ,CAST(DECODE('#PARAM@3#','ABONO',0,'CARGO',MSUB.FCN_ID_TIPO_SUBCTA) AS INT) FCN_ID_TIPO_SUBCTA",
            "    ,CMOV.FCN_ID_TIPO_MONTO",
            "FROM CIERREN_ETL.TTSISGRAL_ETL_DISPERSION DISP",
            "INNER JOIN CIERREN_ETL.TTSISGRAL_ETL_VAL_IDENT_CTE IDNT ON (",
            "        DISP.FTN_NUM_CTA_INVDUAL = IDNT.FTN_NUM_CTA_INVDUAL",
            "        AND (",
            "            DISP.FTN_NSS = IDNT.FTN_NSS",
            "            OR DISP.FTC_CURP = IDNT.FTC_CURP",
            "            )",
            "        )",
            "    JOIN CIERREN.TRAFOGRAL_MOV_SUBCTA MSUB",
            "        ON (MSUB.FCN_ID_TIPO_SUBCTA = DISP.FCN_ID_TIPO_SUBCTA OR DISP.FCN_ID_TIPO_SUBCTA = 0) AND MSUB.FRB_VIGENCIA = 1 AND MSUB.FCN_ID_SUBPROCESO = #PARAM@5#",
            "    JOIN CIERREN.TFAFOGRAL_CONFIG_CONCEP_MOV CMOV",
            "        ON DISP.FFN_ID_CONCEPTO_MOV = CMOV.FFN_ID_CONCEPTO_MOV AND CMOV.FRN_ID_MOV_SUBCTA = MSUB.FRN_ID_MOV_SUBCTA AND CMOV.FFB_VIGENCIA = 1",
            "    JOIN CIERREN.TCCRXGRAL_CAT_CATALOGO CAT",
            "        ON '#PARAM@3#' = CAT.FCC_VALOR AND MSUB.FCN_ID_TIPO_MOV = CAT.FCN_ID_CAT_CATALOGO AND CAT.FCB_VIGENCIA = 1",
            "    JOIN CIERREN.TCCRXGRAL_TIPO_CAT TCAT",
            "        ON CAT.FCN_ID_TIPO_CAT = TCAT.FCN_ID_TIPO_CAT AND TCAT.FCN_ID_TIPO_CAT = 25 AND TCAT.FCB_VIGENCIA = 1",
            "WHERE DISP.FTC_FOLIO = DECODE('#PARAM@3#', 'ABONO', '#PARAM@1#', '#PARAM@2#')",
            "AND IDNT.FTC_FOLIO = DECODE('#PARAM@3#', 'ABONO', '#PARAM@1#', '#PARAM@2#')",
            "    AND (",
            "        DISP.FCN_ID_SUBPROCESO IN (8, 121, 439, 9)",
            "        OR (DISP.FCN_ID_SUBPROCESO IN (120, 210, 122, 105))",
            "        AND IDNT.FTN_ESTATUS_DIAG = 1",
            "        )"
          ]
        },
        {
          "step_id" : "015",
          "subprocess" : "MVC",
          "description" : [
            "descripcion - Este query genera la tabla TEMP_DOIMSS_MCV_MONTOS_CLIENTE",
            "#PARAM@1# = Tabla delta"
          ],
          "value": [
            "SELECT",
            "    DCI.FTC_FOLIO",
            "    ,DCI.FCN_ID_PROCESO",
            "    ,DCI.FCN_ID_SUBPROCESO",
            "    ,DCI.FTN_NUM_CTA_INVDUAL",
            "    ,DCI.FCN_ID_TIPO_SUBCTA",
            "    ,sum(DCI.FTF_MONTO) FTN_MONTO",
            "    ,DCI.FTC_FOLIO_REL",
            "    ,DCI.FCN_ID_TIPO_MONTO",
            "FROM (",
            "    SELECT FTC_FOLIO",
            "        ,FCN_ID_PROCESO",
            "        ,FCN_ID_SUBPROCESO",
            "        ,FTN_NUM_CTA_INVDUAL",
            "        ,0 FCN_ID_TIPO_SUBCTA",
            "        ,CASE WHEN FFN_ID_CONCEPTO_MOV IN (637, 638, 1003, 1002) THEN FTF_MONTO_ACCIONES ELSE FTF_MONTO_PESOS END FTF_MONTO",
            "        ,FFN_ID_CONCEPTO_MOV",
            "        ,FTC_FOLIO_REL",
            "        ,TIPO_MOV",
            "        ,FCN_ID_TIPO_MONTO",
            "    FROM #PARAM@1# DCI",
            "    WHERE TIPO_MOV = 'ABONO'",
            "        AND FFN_ID_CONCEPTO_MOV NOT IN (231, 637, 638, 1002, 1003)",
            "    UNION ALL ",
            "    SELECT FTC_FOLIO",
            "        ,FCN_ID_PROCESO",
            "        ,FCN_ID_SUBPROCESO",
            "        ,FTN_NUM_CTA_INVDUAL",
            "        ,FCN_ID_TIPO_SUBCTA",
            "        ,CASE WHEN FFN_ID_CONCEPTO_MOV IN (637, 638, 1003, 1002) THEN FTF_MONTO_ACCIONES ELSE FTF_MONTO_PESOS END FTF_MONTO",
            "        ,FFN_ID_CONCEPTO_MOV",
            "        ,FTC_FOLIO_REL",
            "        ,TIPO_MOV",
            "        ,FCN_ID_TIPO_MONTO",
            "    FROM #PARAM@1# DCI",
            "    WHERE TIPO_MOV = 'CARGO'",
            "        AND FFN_ID_CONCEPTO_MOV IN (231, 637, 638, 1003, 1002)",
            "        AND FNN_ID_VIV_GARANTIA = 1",
            "        AND (",
            "            (",
            "                FFN_ID_CONCEPTO_MOV = 231",
            "                AND FTF_MONTO_PESOS > 0",
            "                ) ",
            "            or ",
            "                (",
            "                FFN_ID_CONCEPTO_MOV  in (637, 638,1003,1002)",
            "                AND FTF_MONTO_ACCIONES > 0",
            "                )",
            "            )",
            ")DCI",
            "GROUP BY",
            "    DCI.FTC_FOLIO",
            "    ,DCI.FCN_ID_PROCESO",
            "    ,DCI.FCN_ID_SUBPROCESO",
            "    ,DCI.FTN_NUM_CTA_INVDUAL",
            "    ,DCI.FCN_ID_TIPO_SUBCTA",
            "    ,DCI.FTC_FOLIO_REL",
            "    ,DCI.FCN_ID_TIPO_MONTO"
          ]
        },
        {
          "step_id" : "016",
          "subprocess" : "MVC",
          "description" : [
            "descripcion - Este query Carga la tabla TTSISGRAL_ETL_DISPERSION, utilizando este query el número 14 debería eliminarse"
          ],
          "value": [
            "SELECT '#PARAM@1#' FTC_FOLIO",
            "    ,'#PARAM@2#' FTC_FOLIO_REL",
            "    ,DISP.FTN_NUM_CTA_INVDUAL",
            "    ,DISP.FTN_NSS",
            "    ,DISP.FTC_CURP",
            "    ,DISP.FTF_MONTO_PESOS",
            "    ,DISP.FTF_MONTO_ACCIONES",
            "    ,DISP.FFN_ID_CONCEPTO_MOV",
            "    ,DISP.FNN_ID_VIV_GARANTIA",
            "    ,DISP.FCN_ID_PROCESO",
            "    ,#PARAM@5# FCN_ID_SUBPROCESO",
            "    ,'#PARAM@3#' AS TIPO_MOV",
            "FROM CIERREN_ETL.TTSISGRAL_ETL_DISPERSION DISP",
            "WHERE DISP.FTC_FOLIO = DECODE('#PARAM@3#', 'ABONO', '#PARAM@1#', '#PARAM@2#')",
            "AND DISP.FCN_ID_SUBPROCESO IN (8, 121, 439, 9, 120, 210, 122, 105, 118) "
          ]
        },
        {
          "step_id" : "017",
          "subprocess" : "MVC",
          "description" : [
            "descripcion - Este query Carga la tabla TTSISGRAL_ETL_VAL_IDENT_CTE, utilizando este query el número 14 debería eliminarse"
          ],
          "value": [
            "SELECT IDNT.FTN_NUM_CTA_INVDUAL",
            "    ,IDNT.FTN_NSS",
            "    ,IDNT.FTC_CURP",
            "    ,IDNT.FTN_ESTATUS_DIAG",
            "FROM CIERREN_ETL.TTSISGRAL_ETL_VAL_IDENT_CTE IDNT",
            "WHERE IDNT.FTN_ESTATUS_DIAG = 1",
            "AND IDNT.FTC_FOLIO = DECODE('#PARAM@3#', 'ABONO', '#PARAM@1#', '#PARAM@2#')"
          ]
        },
        {
          "step_id" : "018",
          "subprocess" : "MVC",
          "description" : [
            "descripcion - Este query Carga la tabla TFAFOGRAL_CONFIG_CONCEP_MOV, utilizando este query el número 14 debería eliminarse"
          ],
          "value": [
            "SELECT  CMOV.FRN_ID_MOV_SUBCTA",
            "    ,MSUB.FCN_ID_SUBPROCESO",
            "    ,CAST(DECODE('#PARAM@3#','ABONO',0,'CARGO',MSUB.FCN_ID_TIPO_SUBCTA) AS INT) FCN_ID_TIPO_SUBCTA",
            "    ,MSUB.FCN_ID_TIPO_MOV",
            "    ,CMOV.FFN_ID_CONCEPTO_MOV",
            "    ,CMOV.FCN_ID_TIPO_MONTO",
            "    ,CAT.FCC_VALOR AS TIPO_MOV",
            "   FROM CIERREN.TFAFOGRAL_CONFIG_CONCEP_MOV CMOV",
            "   INNER JOIN CIERREN.TRAFOGRAL_MOV_SUBCTA MSUB ON CMOV.FRN_ID_MOV_SUBCTA = MSUB.FRN_ID_MOV_SUBCTA",
            "   INNER JOIN CIERREN.TCCRXGRAL_CAT_CATALOGO CAT ON MSUB.FCN_ID_TIPO_MOV = CAT.FCN_ID_CAT_CATALOGO",
            "   INNER JOIN CIERREN.TCCRXGRAL_TIPO_CAT TCAT ON CAT.FCN_ID_TIPO_CAT = TCAT.FCN_ID_TIPO_CAT",
            "   WHERE  CMOV.FFB_VIGENCIA = 1",
            "   AND    MSUB.FRB_VIGENCIA = 1",
            "   AND    MSUB.FCN_ID_SUBPROCESO = #PARAM@5#",
            "   AND    TCAT.FCN_ID_TIPO_CAT = 25",
            "   AND    TCAT.FCB_VIGENCIA = 1",
            "   AND    CAT.FCB_VIGENCIA = 1"
          ]
        },
        {
          "step_id" : "019",
          "subprocess" : "MVC",
          "description" : [
            "descripcion - Este query realiza la transformación y uniones de las tablas cargadas durante la extracción, al usar este query y los anteriores el query 14 debería borrarse",
            "#PARAM@1# = #DELTA_TABLA1# = DELTA DISPERSIONES",
            "#PARAM@2# = #DELTA_TABLA2# = DELTA TTSISGRAL_ETL_VAL_IDENT_CTE",
            "#PARAM@3# = #DELTA_TABLA3# = DELTA CATALOGOS"
          ],
          "value": [
            "SELECT DISP.FTC_FOLIO",
            "    ,DISP.FTC_FOLIO_REL",
            "    ,DISP.FTN_NUM_CTA_INVDUAL",
            "    ,CASE WHEN DISP.FFN_ID_CONCEPTO_MOV IN (637, 638, 1003, 1002) THEN DISP.FTF_MONTO_ACCIONES ELSE DISP.FTF_MONTO_PESOS END FTF_MONTO",
            "    ,DISP.FTF_MONTO_PESOS",
            "    ,DISP.FTF_MONTO_ACCIONES",
            "    ,DISP.FFN_ID_CONCEPTO_MOV",
            "    ,DISP.FCN_ID_PROCESO",
            "    ,DISP.FCN_ID_SUBPROCESO",
            "    ,DISP.TIPO_MOV",
            "    ,DISP.FNN_ID_VIV_GARANTIA",
            "    ,CAT.FCN_ID_TIPO_SUBCTA",
            "    ,CAT.FCN_ID_TIPO_MONTO",
            "FROM #PARAM@1# DISP",
            "INNER JOIN #PARAM@2# IDNT ON (",
            "        DISP.FTN_NUM_CTA_INVDUAL = IDNT.FTN_NUM_CTA_INVDUAL",
            "        AND (",
            "            DISP.FTN_NSS = IDNT.FTN_NSS",
            "            OR DISP.FTC_CURP = IDNT.FTC_CURP",
            "            )",
            "        )",
            "INNER JOIN #PARAM@3# CAT ON CAT.FFN_ID_CONCEPTO_MOV = DISP.FFN_ID_CONCEPTO_MOV"
            
          ]
        },
        {
          "step_id" : "020",
          "subprocess" : "MVC",
          "description" : [
            "descripcion - Este query realiza la agrupación, al usar este query y los anteriores el query 14 debería borrarse",
            "#PARAM@1# = #DELTA_TABLA1# = DELTA DISPERSIONES"
          ],
          "value": [
            "SELECT",
            "    FTC_FOLIO",
            "    ,FCN_ID_PROCESO",
            "    ,FCN_ID_SUBPROCESO",
            "    ,FTN_NUM_CTA_INVDUAL",
            "    ,FCN_ID_TIPO_SUBCTA",
            "    ,sum(FTF_MONTO) FTN_MONTO",
            "    ,FTC_FOLIO_REL",
            "    ,FCN_ID_TIPO_MONTO",
            "FROM (",
            "    SELECT  ",
            "    DCI.FTC_FOLIO",
            "    ,DCI.FCN_ID_PROCESO",
            "    ,DCI.FCN_ID_SUBPROCESO",
            "    ,DCI.FTN_NUM_CTA_INVDUAL",
            "    ,DCI.FCN_ID_TIPO_SUBCTA",
            "    ,DCI.FTF_MONTO",
            "    ,DCI.FTC_FOLIO_REL",
            "    ,DCI.FCN_ID_TIPO_MONTO",
            "    FROM #PARAM@1# DCI",
            "    WHERE DCI.TIPO_MOV = 'ABONO'",
            "        AND DCI.FFN_ID_CONCEPTO_MOV NOT IN (231, 637, 638, 1002, 1003)",
            "    UNION ALL ",
            "    SELECT ",
            "    DCI2.FTC_FOLIO",
            "    ,DCI2.FCN_ID_PROCESO",
            "    ,DCI2.FCN_ID_SUBPROCESO",
            "    ,DCI2.FTN_NUM_CTA_INVDUAL",
            "    ,DCI2.FCN_ID_TIPO_SUBCTA",
            "    ,DCI2.FTF_MONTO",
            "    ,DCI2.FTC_FOLIO_REL",
            "    ,DCI2.FCN_ID_TIPO_MONTO",
            "    FROM #PARAM@1# DCI2",
            "    WHERE DCI2.TIPO_MOV = 'CARGO'",
            "        AND DCI2.FFN_ID_CONCEPTO_MOV IN (231, 637, 638, 1003, 1002)",
            "        AND DCI2.FNN_ID_VIV_GARANTIA = 1",
            "        AND (",
            "            (",
            "                DCI2.FFN_ID_CONCEPTO_MOV = 231",
            "                AND DCI2.FTF_MONTO_PESOS > 0",
            "                ) ",
            "            or ",
            "                (",
            "                DCI2.FFN_ID_CONCEPTO_MOV  in (637, 638,1003,1002)",
            "                AND DCI2.FTF_MONTO_ACCIONES > 0",
            "                )",
            "            )",
            ") GROUP BY",
            "    FTC_FOLIO",
            "    ,FCN_ID_PROCESO",
            "    ,FCN_ID_SUBPROCESO",
            "    ,FTN_NUM_CTA_INVDUAL",
            "    ,FCN_ID_TIPO_SUBCTA",
            "    ,FTC_FOLIO_REL",
            "    ,FCN_ID_TIPO_MONTO"
            
          ]
        }
    ]
}