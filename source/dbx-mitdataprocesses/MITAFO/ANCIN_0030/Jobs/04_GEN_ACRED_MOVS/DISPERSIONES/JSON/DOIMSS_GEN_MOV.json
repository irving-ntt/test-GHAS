{
  "flow": "DOIMSS",
  "id": "4",
  "steps": [
    {
      "step_id": "001",
      "source": "GEN_MOV",
      "description": [
        "#PARAM@1# = #SR_FOLIO# =",
        "#PARAM@2# = #SR_FOLIO_REL# ="
      ],
      "value": [
        "SELECT ",
        "DIS.FCN_ID_TIPO_SUBCTA, ",
        "#PARAM@1# AS FTC_FOLIO,",
        "#PARAM@2# AS FTC_FOLIO_REL,",
        "DIS.FCN_ID_SIEFORE, ",
        "DIS.FTF_MONTO_PESOS, ",
        "DIS.FTN_NUM_CTA_INVDUAL,",
        "DIS.FTD_FEC_CRE, ",
        "DIS.FTC_USU_CRE, ",
        "DIS.FTD_FEC_ACT, ",
        "DIS.FTC_USU_ACT, ",
        "DIS.FFN_ID_CONCEPTO_MOV, ",
        "DIS.FTC_TABLA_NCI_MOV, ",
        "DIS.FNN_ID_REFERENCIA,",
        "DECODE(DIS.FCN_ID_SUBPROCESO, 8,'IMSS',118,'IMSS',439,'IMSS',121,'IMSS',9,'IMSS',227,'IMSS',120,'ISSSTE',210,'ISSSTE',122,'ISSSTE',105,'ISSSTE',839,'ISSSTE','XXXXX') AS INSTITUTO,",
        "NULL FTN_ID_ERROR_VAL,",
        "DIS.FTN_NO_LINEA",
        "FROM CIERREN_ETL.TTSISGRAL_ETL_DISPERSION DIS",
        "WHERE DIS.FTC_FOLIO='#PARAM@1#'",
        "AND DIS.FTF_MONTO_PESOS > 0",
        "AND DIS.FFN_ID_CONCEPTO_MOV NOT IN (637,638,1002,1003,231)",
        "AND DIS.FCN_ID_SIEFORE",
        "NOT IN (846)",
        "AND DIS.FCN_ID_SUBPROCESO NOT IN (118)"
      ]
    },
    {
      "step_id": "002",
      "source": "GEN_MOV",
      "description": ["#PARAM@1# = #SR_FOLIO# ="],
      "value": [
        "SELECT FTN_NUM_CTA_INVDUAL,FTN_ID_MARCA",
        "FROM CIERREN.TTAFOGRAL_MATRIZ_CONVIVENCIA",
        "WHERE FTB_ESTATUS_MARCA = '1'",
        "and FTC_FOLIO='#PARAM@1#'"
      ]
    },
    {
      "step_id": "003",
      "source": "GEN_MOV",
      "description": [],
      "value": [
        "SELECT ",
        "FCN_ID_TIPO_SUBCTA, ",
        "FCN_ID_REGIMEN,",
        "FCN_ID_PLAZO",
        "from CIERREN.TCCRXGRAL_TIPO_SUBCTA"
      ]
    },
    {
      "step_id": "004",
      "source": "GEN_MOV",
      "description": ["#PARAM@1# = #SR_FEC_ACC# ="],
      "value": [
        "SELECT FCN_ID_VALOR_ACCION,FCN_VALOR_ACCION,FCN_ID_SIEFORE,FCN_ID_REGIMEN",
        "FROM CIERREN.TCAFOGRAL_VALOR_ACCION",
        "WHERE TRUNC(FCD_FEH_ACCION) = TO_DATE('#PARAM@1#','YYYY-MM-DD')"
      ]
    },
    {
      "step_id": "005",
      "source": "GEN_MOV",
      "description": [],
      "value": [
        "SELECT UNIQUE FFN_ID_CONCEPTO_MOV,NVL(FTN_DEDUCIBLE,0) FTN_DEDUCIBLE ",
        "FROM CIERREN.TFAFOGRAL_CONFIG_CONCEP_MOV",
        "WHERE FFB_VIGENCIA = '1'"
      ]
    },
    {
      "step_id": "006",
      "source": "GEN_MOV",
      "description": ["#PARAM@1# = #SR_FOLIO# ="],
      "value": [
        "SELECT DIS.FCN_ID_TIPO_SUBCTA, ",
        "DIS.FCN_ID_SIEFORE, ",
        "DIS.FTF_MONTO_ACCIONES,",
        "DIS.FTN_NUM_CTA_INVDUAL,",
        "DIS.FTC_TABLA_NCI_MOV, ",
        "DIS.FTN_NO_LINEA,",
        "DECODE(DIS.FFN_ID_CONCEPTO_MOV,270,225,271,226,272,227,699,670,700,671,701,672,702,673,696,647,697,648,698,649) FFN_ID_CONCEPTO_MOV",
        "FROM  CIERREN_ETL.TTSISGRAL_ETL_DISPERSION DIS",
        "WHERE DIS.FTC_FOLIO='#PARAM@1#' ",
        "AND DIS.FTF_MONTO_ACCIONES > 0 ",
        "AND FTC_TABLA_NCI_MOV = 'VIV'",
        "AND DIS.FTN_NUM_CTA_INVDUAL IS NOT NULL ",
        "AND DIS.FFN_ID_CONCEPTO_MOV NOT IN (637,638,1002,1003,231)",
        "AND DIS.FCN_ID_SIEFORE IS NOT NULL"
      ]
    },
    {
      "step_id": "007",
      "source": "GEN_MOV",
      "description": [],
      "value": [
        "SELECT nvl((",
        "SELECT max(FTN_ID_BAL_MOV)",
        "FROM CIERREN.TTAFOGRAL_BALANCE_MOVS",
        "), 0) AS MAXIMO1",
        ",nvl((",
        "SELECT max(ftn_id_mov)",
        "FROM CIERREN_ETL.TTSISGRAL_ETL_MOVIMIENTOS",
        "), 0) AS MAXIMO2",
        ",1 LLAVE",
        "FROM dual"
      ]
    },
    {
      "step_id": "008",
      "source": "GEN_MOV",
      "description": [
        "#PARAM@1# = #COUNT_ROJO# =",
        "#PARAM@2# = #COUNT_VERDE# =",
        "#PARAM@3# = #CIERREN.TTCRXGRAL_FOLIO# =",
        "#PARAM@4# = #CIERREN.TRAFOGRAL_ARCHIVO_FOLIO# =",
        "#PARAM@5# = #SR_FOLIO# ="
      ],
      "value": [
        "SELECT AR.FTN_ID_ARCHIVO,",
        "       #PARAM@1# COUNT_ROJO,",
        "       #PARAM@2# COUNT_VERDE",
        "FROM   #PARAM@3# FOL",
        "LEFT JOIN #PARAM@4# AR ON FOL.FTC_FOLIO = AR.FTC_FOLIO",
        "WHERE FOL.FTC_FOLIO = '#PARAM@5#'"
      ]
    },
    {
      "step_id": "009",
      "source": "GEN_MOV",
      "description": [
        "#PARAM@1# = #CX_CRE_ESQUEMA# =",
        "#PARAM@2# = #TL_CRE_DISPERSION# =",
        "#PARAM@3# = #CIERREN.TRAFOGRAL_MOV_SUBCTA# =",
        "#PARAM@4# = #CIERREN.TTAFOGRAL_MATRIZ_CONVIVENCIA# =",
        "#PARAM@5# = #CIERREN.TFAFOGRAL_CONFIG_CONCEP_MOV# =",
        "#PARAM@6# = #SR_FOLIO# =",
        "#PARAM@7# = #SR_ETAPA# =",
        "#PARAM@8# = #SR_FOLIO_REL# =",
        "#PARAM@9# = #CIERREN_ETL.TTSISGRAL_ETL_DISPERSION# =",
        "#PARAM@10# = #CIERREN.TCAFOGRAL_VALOR_ACCION# =",
        "#PARAM@11# = #SR_FEC_ACC# ="
      ],
      "value": [
        "WITH TABLE1 AS (",
        "    SELECT CONV.FTC_FOLIO_REL,",
        "           DISP1.FTN_NUM_CTA_INVDUAL,",
        "           DISP1.FCN_ID_TIPO_SUBCTA,",
        "           DISP1.FCN_ID_SIEFORE,",
        "           CMOV.FTN_DEDUCIBLE,",
        "           SUM(DISP1.FTF_MONTO_PESOS) FTF_MONTO_PESOS,",
        "           SUM(DISP1.FTF_MONTO_ACCIONES) FTF_MONTO_ACCIONES",
        "    FROM   #PARAM@1#.#PARAM@2# DISP1",
        "    INNER JOIN #PARAM@3# MOV ",
        "        ON DISP1.FCN_ID_TIPO_SUBCTA = MOV.FCN_ID_TIPO_SUBCTA",
        "    INNER JOIN #PARAM@4# CONV ",
        "        ON CONV.FTC_FOLIO_REL = DISP1.FTC_FOLIO ",
        "       AND DISP1.FTN_NUM_CTA_INVDUAL = CONV.FTN_NUM_CTA_INVDUAL ",
        "       AND CONV.FTB_ESTATUS_MARCA = '1' ",
        "       AND MOV.FRN_ID_MOV_SUBCTA = CONV.FRN_ID_MOV_SUBCTA",
        "    INNER JOIN #PARAM@5# CMOV ",
        "        ON CMOV.FFN_ID_CONCEPTO_MOV = DISP1.FFN_ID_CONCEPTO_MOV",
        "    WHERE  DISP1.FTC_TABLA_NCI_MOV = 'VIV' ",
        "    AND    DISP1.FNN_ID_VIV_GARANTIA = '1'",
        "    AND    CONV.FTC_FOLIO = #PARAM@6#",
        "    AND    CONV.FTC_FOLIO_REL = DECODE(#PARAM@7#,3,CONV.FTC_FOLIO_REL,1,#PARAM@8#)",
        "    AND    DISP1.FFN_ID_CONCEPTO_MOV IN (637, 638, 1002, 1003, 231)",
        "    AND    DISP1.FCN_ID_SIEFORE NOT IN (846)",
        "    GROUP BY CONV.FTC_FOLIO_REL, ",
        "             DISP1.FTN_NUM_CTA_INVDUAL,",
        "             DISP1.FCN_ID_TIPO_SUBCTA,",
        "             DISP1.FCN_ID_SIEFORE,",
        "             CMOV.FTN_DEDUCIBLE",
        ")",
        "SELECT T1.FTF_MONTO_ACCIONES AS TOTAL_ACCIONES,",
        "       T1.FTF_MONTO_PESOS AS TOTAL_PESOS,",
        "       DISP2.FCN_ID_TIPO_SUBCTA,",
        "       '#PARAM@6#' AS FTC_FOLIO,",
        "       CONV.FTC_FOLIO_REL,",
        "       DISP2.FCN_ID_SIEFORE,",
        "       DISP2.FTF_MONTO_PESOS,",
        "       (CASE ",
        "            WHEN DISP2.FCN_ID_SUBPROCESO IN (8, 118, 439, 121, 9, 227) ",
        "                THEN NVL(ROUND((DISP2.FTF_MONTO_PESOS / VA.FCN_VALOR_ACCION), 2), 0) ",
        "            WHEN DISP2.FCN_ID_SUBPROCESO IN (120, 210, 122, 105, 839) ",
        "                THEN NVL(DISP2.FTF_MONTO_ACCIONES, 0)",
        "            ELSE NVL(DISP2.FTF_MONTO_ACCIONES, 0)",
        "        END) FTF_MONTO_ACCIONES,",
        "       VA.FCN_ID_VALOR_ACCION,",
        "       DISP2.FTN_NUM_CTA_INVDUAL,",
        "       CONV.FTN_ID_MARCA,",
        "       DISP2.FTD_FEC_CRE,",
        "       DISP2.FTC_USU_CRE,",
        "       DISP2.FTD_FEC_ACT,",
        "       DISP2.FTC_USU_ACT,",
        "       DISP2.FFN_ID_CONCEPTO_MOV,",
        "       DISP2.FTC_TABLA_NCI_MOV,",
        "       DISP2.FNN_ID_REFERENCIA,",
        "       VA.FCN_VALOR_ACCION,",
        "       NVL(CMOV.FTN_DEDUCIBLE, 0) FTN_DEDUCIBLE,",
        "       DECODE(DISP2.FCN_ID_SUBPROCESO, ",
        "              8, 'IMSS', ",
        "              118, 'IMSS', ",
        "              439, 'IMSS', ",
        "              121, 'IMSS', ",
        "              9, 'IMSS', ",
        "              227, 'IMSS', ",
        "              120, 'ISSSTE', ",
        "              210, 'ISSSTE', ",
        "              122, 'ISSSTE', ",
        "              105, 'ISSSTE', ",
        "              839, 'ISSSTE', ",
        "              'XXXXX') AS INSTITUTO",
        "FROM   TABLE1 T1",
        "INNER JOIN #PARAM@9# DISP2 ",
        "    ON T1.FTC_FOLIO_REL = DISP2.FTC_FOLIO ",
        "   AND T1.FTN_NUM_CTA_INVDUAL = DISP2.FTN_NUM_CTA_INVDUAL ",
        "   AND T1.FCN_ID_TIPO_SUBCTA = DISP2.FCN_ID_TIPO_SUBCTA ",
        "   AND T1.FCN_ID_SIEFORE = DISP2.FCN_ID_SIEFORE",
        "INNER JOIN #PARAM@3# MOV ",
        "    ON DISP2.FCN_ID_TIPO_SUBCTA = MOV.FCN_ID_TIPO_SUBCTA",
        "INNER JOIN #PARAM@4# CONV ",
        "    ON CONV.FTC_FOLIO_REL = DISP2.FTC_FOLIO ",
        "   AND DISP2.FTN_NUM_CTA_INVDUAL = CONV.FTN_NUM_CTA_INVDUAL ",
        "   AND CONV.FTB_ESTATUS_MARCA = '1' ",
        "   AND MOV.FRN_ID_MOV_SUBCTA = CONV.FRN_ID_MOV_SUBCTA",
        "LEFT JOIN #PARAM@10# VA ",
        "    ON VA.FCN_ID_SIEFORE = DISP2.FCN_ID_SIEFORE ",
        "   AND TRUNC(VA.FCD_FEH_ACCION) = TO_DATE('#PARAM@11#', 'YYYY-MM-DD') ",
        "   AND DISP2.FCN_ID_REGIMEN = VA.FCN_ID_REGIMEN",
        "INNER JOIN #PARAM@5# CMOV ",
        "    ON CMOV.FFN_ID_CONCEPTO_MOV = DISP2.FFN_ID_CONCEPTO_MOV",
        "WHERE  DISP2.FTC_TABLA_NCI_MOV = 'VIV'",
        "AND    DISP2.FNN_ID_VIV_GARANTIA = '1'",
        "AND    CONV.FTC_FOLIO = #PARAM@6#",
        "AND    CONV.FTC_FOLIO_REL = DECODE(#PARAM@7#,3,CONV.FTC_FOLIO_REL,1,#PARAM@8#)",
        "AND    (DISP2.ftf_monto_acciones > 0 OR DISP2.ftf_monto_pesos > 0)",
        "AND    DISP2.FFN_ID_CONCEPTO_MOV IN (637, 638, 1002, 1003, 231)",
        "AND    DISP2.FCN_ID_SIEFORE IS NOT NULL",
        "AND    DISP2.FCN_ID_SIEFORE NOT IN (846)"
      ]
    },
    {
      "step_id": "010",
      "source": "GEN_MOV",
      "description": [
        "#PARAM@1# = #CIERREN.TTAFOGRAL_BALANCE_MOVS# =",
        "#PARAM@2# = #CIERREN_ETL.TTSISGRAL_ETL_DISPERSION# =",
        "#PARAM@3# = #CIERREN.TRAFOGRAL_MOV_SUBCTA# =",
        "#PARAM@4# = #CIERREN.TTAFOGRAL_MATRIZ_CONVIVENCIA# =",
        "#PARAM@5# = #CIERREN.TFAFOGRAL_CONFIG_CONCEP_MOV# =",
        "#PARAM@6# = #SR_FOLIO# =",
        "#PARAM@7# = #SR_ETAPA# =",
        "#PARAM@8# = #SR_FOLIO_REL# ="
      ],
      "value": [
        "SELECT FTN_NUM_CTA_INVDUAL,",
        "       FCN_ID_TIPO_SUBCTA,",
        "       FCN_ID_SIEFORE,",
        "       FTN_DEDUCIBLE,",
        "       SUM(FTN_DISP_PESOS) FTN_DISP_PESOS,",
        "       SUM(FTN_DISP_ACCIONES) FTN_DISP_ACCIONES,",
        "       FCN_ID_PLAZO",
        "FROM (",
        "    SELECT a.FTC_NUM_CTA_INVDUAL AS FTN_NUM_CTA_INVDUAL,",
        "           a.FCN_ID_TIPO_SUBCTA,",
        "           a.FCN_ID_SIEFORE,",
        "           DECODE(a.FTN_DEDUCIBLE, NULL, 0, FTN_DEDUCIBLE) FTN_DEDUCIBLE,",
        "           NVL(a.FTN_DISP_PESOS, 0) FTN_DISP_PESOS,",
        "           NVL(a.FTN_DISP_ACCIONES, 0) FTN_DISP_ACCIONES,",
        "           DECODE(a.FCN_ID_PLAZO, 0, 1000, a.FCN_ID_PLAZO) FCN_ID_PLAZO",
        "    FROM #PARAM@1# a,",
        "         (SELECT",
        "                 UNIQUE DIS.FTN_NUM_CTA_INVDUAL",
        "          FROM   #PARAM@2# DIS",
        "          INNER JOIN #PARAM@3# MOV",
        "              ON DIS.FCN_ID_TIPO_SUBCTA = MOV.FCN_ID_TIPO_SUBCTA",
        "          INNER JOIN #PARAM@4# CONV",
        "              ON CONV.FTC_FOLIO_REL = DIS.FTC_FOLIO",
        "             AND DIS.FTN_NUM_CTA_INVDUAL = CONV.FTN_NUM_CTA_INVDUAL",
        "             AND CONV.FTB_ESTATUS_MARCA = '1'",
        "             AND MOV.FRN_ID_MOV_SUBCTA = CONV.FRN_ID_MOV_SUBCTA",
        "          INNER JOIN #PARAM@5# CMOV",
        "              ON CMOV.FFN_ID_CONCEPTO_MOV = DIS.FFN_ID_CONCEPTO_MOV",
        "          WHERE  DIS.FTC_TABLA_NCI_MOV = 'VIV'",
        "          AND    DIS.FNN_ID_VIV_GARANTIA = '1'",
        "          AND    CONV.FTC_FOLIO = '#PARAM@6#'",
        "          AND    CONV.FTC_FOLIO_REL = DECODE(#PARAM@7#, 3, CONV.FTC_FOLIO_REL, 1, '#PARAM@8#')",
        "          AND    DIS.FFN_ID_CONCEPTO_MOV IN (637, 638, 1002, 1003, 231)",
        "          AND    DIS.FCN_ID_SIEFORE NOT IN (846)",
        "         ) b",
        "    WHERE a.FTC_NUM_CTA_INVDUAL = b.FTN_NUM_CTA_INVDUAL",
        ")",
        "GROUP BY FTN_NUM_CTA_INVDUAL,",
        "         FCN_ID_TIPO_SUBCTA,",
        "         FCN_ID_SIEFORE,",
        "         FTN_DEDUCIBLE,",
        "         FCN_ID_PLAZO",
        "ORDER BY FTN_NUM_CTA_INVDUAL,",
        "         FCN_ID_TIPO_SUBCTA,",
        "         FCN_ID_SIEFORE,",
        "         FTN_DEDUCIBLE,",
        "         FCN_ID_PLAZO"
      ]
    },
    {
      "step_id": "011",
      "source": "GEN_MOV",
      "description": [
        "#PARAM@1# = #CIERREN_ETL.TTSISGRAL_ETL_MOVIMIENTOS# =",
        "#PARAM@2# = #CIERREN_ETL.TTSISGRAL_ETL_VAL_IDENT_CTE# =",
        "#PARAM@3# = #CIERREN.TCAFOGRAL_VALOR_ACCION# =",
        "#PARAM@4# = #CIERREN.TCCRXGRAL_CAT_CATALOGO# =",
        "#PARAM@5# = #SR_FOLIO# ="
      ],
      "value": [
        "SELECT MOV.FTC_FOLIO_REL,",
        "    CTE.FTC_CURP,",
        "    CTE.FTN_NSS,",
        "    MOV.FTN_NUM_CTA_INVDUAL,",
        "    MOV.FTF_MONTO_PESOS,",
        "    MOV.FTF_MONTO_ACCIONES,",
        "    CAT_VA.FCN_VALOR_ACCION,",
        "    CAT_SI.FCC_VALOR SIEFORE,",
        "    MOV.FTD_FEH_LIQUIDACION,",
        "    CAT_TM.FCC_VALOR TIPO_MOV,",
        "    CAT_CO.FCC_VALOR CONCEPTO_MOV",
        "FROM #PARAM@1# MOV,",
        "#PARAM@2# CTE,",
        "#PARAM@3# CAT_VA,",
        "#PARAM@4# CAT_SI,",
        "#PARAM@4# CAT_TM,",
        "#PARAM@4# CAT_CO",
        "WHERE MOV.FTC_FOLIO = '#PARAM@5#'",
        "AND MOV.FTN_ID_ERROR_VAL = 283",
        "AND CTE.FTN_NUM_CTA_INVDUAL = MOV.FTN_NUM_CTA_INVDUAL",
        "AND CTE.FTC_FOLIO = MOV.FTC_FOLIO",
        "AND CAT_VA.FCN_ID_valor_accion = MOV.FCN_ID_VALOR_ACCION",
        "AND CAT_SI.FCN_ID_CAT_CATALOGO = MOV.FCN_ID_SIEFORE",
        "AND CAT_TM.FCN_ID_CAT_CATALOGO = MOV.FCN_ID_TIPO_MOV",
        "AND CAT_CO.FCN_ID_CAT_CATALOGO = MOV.FCN_ID_CONCEPTO_MOV"
      ]
    },
    {
      "step_id": "012",
      "source": "GEN_MOV",
      "description": ["#PARAM@1# = #CIERREN.TTAFOGRAL_BALANCE_MOVS# ="],
      "value": [
        "SELECT nvl((",
        "SELECT max(FTN_ID_BAL_MOV)",
        "FROM #PARAM@1#",
        "), 0) AS MAXIMO1",
        ",1 LLAVE",
        "FROM dual"
      ]
    },
    {
      "step_id": "013",
      "subprocess": "Acreditacion DOIMSS",
      "description": [
        "#PARAM@1# = #CIERREN_ETL.TTSISGRAL_ETL_MOVIMIENTOS# =",
        "#PARAM@2# = #SR_FTC_FOLIO# =",
        "#PARAM@3# = #SR_FCN_ID_TIPO_MOV# ="
      ],
      "value": [
        "SELECT FTN_ID_MOV,",
        "    FCN_ID_TIPO_SUBCTA,",
        "    FTC_FOLIO,",
        "    FTC_FOLIO_REL,",
        "    FCN_ID_SIEFORE,",
        "    FTF_MONTO_PESOS,",
        "    FTF_MONTO_ACCIONES,",
        "    FCN_ID_VALOR_ACCION,",
        "    FTN_NUM_CTA_INVDUAL,",
        "    FTN_ID_SEMAFORO_MOV,",
        "    FTD_FEH_LIQUIDACION,",
        "    FTD_ID_ESTATUS_MOV,",
        "    FTN_ID_MARCA,",
        "    FCN_ID_TIPO_MOV,",
        "    FCD_FEH_CRE,",
        "    FCC_USU_CRE,",
        "    FCD_FEH_ACT,",
        "    FCC_USU_ACT,",
        "    FCN_ID_CONCEPTO_MOV,",
        "    FCC_TABLA_NCI_MOV,",
        "    FTN_MOV_GENERADO,",
        "    FTN_REG_ACREDITADO,",
        "    FNN_ID_REFERENCIA,",
        "    FTN_ID_ERROR_VAL",
        "FROM #PARAM@1#",
        "WHERE FTC_FOLIO = '#PARAM@2#'",
        "    AND FCN_ID_TIPO_MOV = #PARAM@3#",
        "    AND FTN_ID_SEMAFORO_MOV = 190",
        "    AND FTN_MOV_GENERADO <> 1"
      ]
    },
    {
      "step_id": "014",
      "source": "Acreditacion DOIMSS",
      "description": [
        "#PARAM@1# = #CIERREN_ETL.TTSISGRAL_ETL_MOVIMIENTOS# =",
        "#PARAM@2# = #SR_FTC_FOLIO# =",
        "#PARAM@3# = #SR_FCN_ID_TIPO_MOV# ="
      ],
      "value": [
        "SELECT FTC_FOLIO,",
        "       FCN_ID_TIPO_MOV,",
        "       1 AS FTN_MOV_GENERADO,",
        "       16 AS FTD_ID_ESTATUS_MOV",
        "FROM #PARAM@1#",
        "WHERE FTC_FOLIO = '#PARAM@2#'",
        "  AND FCN_ID_TIPO_MOV = #PARAM@3#",
        "  AND FTN_ID_SEMAFORO_MOV = 190",
        "  AND FTN_ID_ERROR_VAL IS NULL"
      ]
    },
    {
      "step_id": "015",
      "subprocess": "Acreditacion DOIMSS",
      "description": [
        "#PARAM@1# = #CIERREN_ETL.TTSISGRAL_ETL_MOVIMIENTOS# =",
        "#PARAM@2# = #CIERREN_ETL.TTSISGRAL_ETL_MOVIMIENTOS_AUX# ="
      ],
      "value": [
        "MERGE INTO #PARAM@1# ori",
        "USING (",
        "    SELECT ",
        "        FTC_FOLIO,",
        "        FCN_ID_TIPO_MOV,",
        "        FTN_MOV_GENERADO,",
        "        FTD_ID_ESTATUS_MOV",
        "    FROM (",
        "        SELECT ",
        "            FTC_FOLIO,",
        "            FCN_ID_TIPO_MOV,",
        "            FTN_MOV_GENERADO,",
        "            FTD_ID_ESTATUS_MOV,",
        "            ROW_NUMBER() OVER (PARTITION BY FTC_FOLIO, FCN_ID_TIPO_MOV ORDER BY FTC_FOLIO) AS rn",
        "        FROM #PARAM@2# WHERE FTC_FOLIO = '#PARAM@3#'",
        "    ) subquery",
        "    WHERE rn = 1",
        ") aux ",
        "ON (ori.FTC_FOLIO = aux.FTC_FOLIO",
        "AND ori.FCN_ID_TIPO_MOV = aux.FCN_ID_TIPO_MOV)",
        "WHEN MATCHED THEN",
        "    UPDATE SET",
        "        ori.FTN_MOV_GENERADO = aux.FTN_MOV_GENERADO,",
        "        ori.FTD_ID_ESTATUS_MOV = aux.FTD_ID_ESTATUS_MOV"
      ]
    },
    {
      "step_id": "016",
      "subprocess": "Acreditacion DOIMSS",
      "description": [
        "#PARAM@1# = #CIERREN_ETL.TTSISGRAL_ETL_MOVIMIENTOS_AUX# =",
        "#PARAM@2# = #SR_FTC_FOLIO# ="
      ],
      "value": [
        "DELETE FROM #PARAM@1#",
        "WHERE ",
        "    FTC_FOLIO = '#PARAM@2#'",
        "    AND FCN_ID_TIPO_MOV = 181"
      ]
    },
    {
      "step_id": "017",
      "subprocess": "Acreditacion DOIMSS",
      "description": ["#PARAM@1# = #TEMP_DOIMSS_ACR_01# ="],
      "value": [
        "SELECT FCN_ID_TIPO_SUBCTA,",
        "    FTC_FOLIO,",
        "    FTC_FOLIO_REL,",
        "    FCN_ID_SIEFORE,",
        "    FTF_MONTO_PESOS,",
        "    FTF_MONTO_ACCIONES,",
        "    FCN_ID_VALOR_ACCION,",
        "    FTN_NUM_CTA_INVDUAL,",
        "    FTN_ID_SEMAFORO_MOV,",
        "    FTD_FEH_LIQUIDACION,",
        "    16 AS FTD_ID_ESTATUS_MOV,",
        "    FTN_ID_MARCA,",
        "    FCN_ID_TIPO_MOV,",
        "    FCD_FEH_CRE,",
        "    FCC_USU_CRE,",
        "    FCD_FEH_ACT,",
        "    FCC_USU_ACT,",
        "    FCN_ID_CONCEPTO_MOV,",
        "    FNN_ID_REFERENCIA",
        "FROM #PARAM@1#",
        "WHERE SUBSTR(FCC_TABLA_NCI_MOV,1,3) = 'VIV'"
      ]
    },
    {
      "step_id": "018",
      "subprocess": "Acreditacion DOIMSS",
      "description": ["#PARAM@1# = #GLOBAL_TEMP.TEMP_DOIMSS_ACR_01# ="],
      "value": [
        "SELECT ",
        "    FCN_ID_TIPO_SUBCTA,",
        "    FTC_FOLIO,",
        "    FTC_FOLIO_REL,",
        "    FCN_ID_SIEFORE,",
        "    FTF_MONTO_PESOS,",
        "    FTF_MONTO_ACCIONES,",
        "    FCN_ID_VALOR_ACCION,",
        "    FTN_NUM_CTA_INVDUAL,",
        "    FTN_ID_SEMAFORO_MOV,",
        "    FTD_FEH_LIQUIDACION,",
        "    16 AS FTD_ID_ESTATUS_MOV,",
        "    FTN_ID_MARCA,",
        "    FCN_ID_TIPO_MOV,",
        "    FCD_FEH_CRE,",
        "    FCC_USU_CRE,",
        "    FCD_FEH_ACT,",
        "    FCC_USU_ACT,",
        "    FCN_ID_CONCEPTO_MOV,",
        "    FNN_ID_REFERENCIA",
        "FROM #PARAM@1#",
        "WHERE SUBSTR(FCC_TABLA_NCI_MOV,1,3) = 'RCV'"
      ]
    },
    {
      "step_id": "019",
      "subprocess": "Acreditacion DOIMSS",
      "description": ["#PARAM@1# = #GLOBAL_TEMP.TEMP_DOIMSS_ACR_01# ="],
      "value": [
        "SELECT ",
        "    FCN_ID_TIPO_SUBCTA,",
        "    FTC_FOLIO,",
        "    FTC_FOLIO_REL,",
        "    FCN_ID_SIEFORE,",
        "    FTF_MONTO_PESOS,",
        "    FTF_MONTO_ACCIONES,",
        "    FCN_ID_VALOR_ACCION,",
        "    FTN_NUM_CTA_INVDUAL,",
        "    FTN_ID_SEMAFORO_MOV,",
        "    FTD_FEH_LIQUIDACION,",
        "    16 AS FTD_ID_ESTATUS_MOV,",
        "    FTN_ID_MARCA,",
        "    FCN_ID_TIPO_MOV,",
        "    FCD_FEH_CRE,",
        "    FCC_USU_CRE,",
        "    FCD_FEH_ACT,",
        "    FCC_USU_ACT,",
        "    FCN_ID_CONCEPTO_MOV,",
        "    FNN_ID_REFERENCIA",
        "FROM #PARAM@1#",
        "WHERE SUBSTR(FCC_TABLA_NCI_MOV,1,3) = 'SAR'"
      ]
    },
    {
      "step_id": "020",
      "subprocess": "Acreditacion DOIMSS",
      "description": ["#PARAM@1# = #GLOBAL_TEMP.TEMP_DOIMSS_ACR_01# ="],
      "value": [
        "SELECT ",
        "    FCN_ID_TIPO_SUBCTA,",
        "    FTC_FOLIO,",
        "    FTC_FOLIO_REL,",
        "    FCN_ID_SIEFORE,",
        "    FTF_MONTO_PESOS,",
        "    FTF_MONTO_ACCIONES,",
        "    FCN_ID_VALOR_ACCION,",
        "    FTN_NUM_CTA_INVDUAL,",
        "    FTN_ID_SEMAFORO_MOV,",
        "    FTD_FEH_LIQUIDACION,",
        "    16 AS FTD_ID_ESTATUS_MOV,",
        "    FTN_ID_MARCA,",
        "    FCN_ID_TIPO_MOV,",
        "    FCD_FEH_CRE,",
        "    FCC_USU_CRE,",
        "    FCD_FEH_ACT,",
        "    FCC_USU_ACT,",
        "    FCN_ID_CONCEPTO_MOV,",
        "    FNN_ID_REFERENCIA",
        "FROM #PARAM@1#",
        "WHERE SUBSTR(FCC_TABLA_NCI_MOV,1,3) = 'COM'"
      ]
    },
    {
      "step_id": "021",
      "subprocess": "Acreditacion DOIMSS",
      "description": ["#PARAM@1# = #GLOBAL_TEMP.TEMP_DOIMSS_ACR_01# ="],
      "value": [
        "SELECT ",
        "    FCN_ID_TIPO_SUBCTA,",
        "    FTC_FOLIO,",
        "    FTC_FOLIO_REL,",
        "    FCN_ID_SIEFORE,",
        "    FTF_MONTO_PESOS,",
        "    FTF_MONTO_ACCIONES,",
        "    FCN_ID_VALOR_ACCION,",
        "    FTN_NUM_CTA_INVDUAL,",
        "    FTN_ID_SEMAFORO_MOV,",
        "    FTD_FEH_LIQUIDACION,",
        "    16 AS FTD_ID_ESTATUS_MOV,",
        "    FTN_ID_MARCA,",
        "    FCN_ID_TIPO_MOV,",
        "    FCD_FEH_CRE,",
        "    FCC_USU_CRE,",
        "    FCD_FEH_ACT,",
        "    FCC_USU_ACT,",
        "    FCN_ID_CONCEPTO_MOV,",
        "    FNN_ID_REFERENCIA",
        "FROM #PARAM@1#",
        "WHERE SUBSTR(FCC_TABLA_NCI_MOV,1,3) = 'AVO'"
      ]
    },
    {
      "step_id": "022",
      "subprocess": "Acreditacion DOIMSS",
      "description": ["#PARAM@1# = #CIERREN.TTAFOGRAL_BALANCE_MOVS# ="],
      "value": [
        "SELECT NVL(max(FTN_ID_BAL_MOV), 0) AS MAXIMO",
        ",1 AS LLAVE",
        "FROM #PARAM@1#"
      ]
    },
    {
      "step_id": "023",
      "subprocess": "Acreditacion DOIMSS",
      "description": [
        "#PARAM@1# = #CIERREN_ETL.TTSISGRAL_ETL_MOVIMIENTOS# =",
        "#PARAM@2# = #SR_FTC_FOLIO# =",
        "#PARAM@3# = #SR_FCN_ID_TIPO_MOV# ="
      ],
      "value": [
        "SELECT FTC_FOLIO,",
        "       FCN_ID_TIPO_MOV,",
        "       FTN_ID_SEMAFORO_MOV,",
        "       FTN_ID_ERROR_VAL,",
        "       '1' AS FTN_REG_ACREDITADO -- Valor actualizado",
        "FROM #PARAM@1#",
        "WHERE FTC_FOLIO = '#PARAM@2#'",
        "  AND FCN_ID_TIPO_MOV = #PARAM@3#",
        "  AND FTN_ID_SEMAFORO_MOV = 190",
        "  AND FTN_ID_ERROR_VAL IS NULL"
      ]
    },
    {
      "step_id": "024",
      "subprocess": "Acreditacion DOIMSS",
      "description": [
        "#PARAM@1# = #CIERREN_ETL.TTSISGRAL_ETL_MOVIMIENTOS# =",
        "#PARAM@2# = #CIERREN_ETL.TTSISGRAL_ETL_MOVIMIENTOS_AUX# ="
      ],
      "value": [
        "MERGE INTO #PARAM@1# ori",
        "USING (",
        "    SELECT ",
        "       FTC_FOLIO,",
        "        FCN_ID_TIPO_MOV,",
        "        FTN_ID_SEMAFORO_MOV,",
        "        FTN_ID_ERROR_VAL,",
        "        FTN_REG_ACREDITADO",
        "    FROM (",
        "        SELECT ",
        "        FTC_FOLIO,",
        "        FCN_ID_TIPO_MOV,",
        "        FTN_ID_SEMAFORO_MOV,",
        "        FTN_ID_ERROR_VAL,",
        "        FTN_REG_ACREDITADO,",
        "            ROW_NUMBER() OVER (PARTITION BY FTC_FOLIO, FCN_ID_TIPO_MOV, FTN_ID_SEMAFORO_MOV ORDER BY FTC_FOLIO) rn",
        "        FROM #PARAM@2# WHERE FTC_FOLIO = '#PARAM@3#'",
        "    ) subquery",
        "    WHERE rn = 1",
        ") aux",
        "ON (",
        "    ori.FTC_FOLIO = aux.FTC_FOLIO",
        "    AND ori.FCN_ID_TIPO_MOV = aux.FCN_ID_TIPO_MOV",
        "    AND ori.FTN_ID_SEMAFORO_MOV = aux.FTN_ID_SEMAFORO_MOV",
        ")",
        "WHEN MATCHED THEN",
        "    UPDATE SET",
        "        ori.FTN_REG_ACREDITADO = aux.FTN_REG_ACREDITADO"
      ]
    },
    {
      "step_id": "025",
      "subprocess": "Acreditacion DOIMSS",
      "description": [
        "#PARAM@1# = #CIERREN_ETL.TLSISGRAL_ETL_CLIENTE_SUA# =",
        "#PARAM@2# = #SR_FOLIO# ="
      ],
      "value": [
        "SELECT FNN_ID_REFERENCIA",
        ",FTC_FOLIO",
        ",FTN_NSS",
        ",FTC_RFC",
        ",FTC_CURP",
        ",FTC_NOMBRE",
        ",FNC_PERIODO_PAGO_PATRON",
        ",FND_FECHA_PAGO",
        ",FND_FECHA_VALOR_IMSS_ACV_VIV",
        ",FNN_ULTIMO_SALARIO_INT_PER",
        ",FNC_FOLIO_PAGO_SUA",
        ",FNC_REG_PATRONAL_IMSS",
        ",FNC_RFC_PATRON",
        ",FNN_DIAS_COTZDOS_BIMESTRE",
        ",FNN_DIAS_INCAP_BIMESTRE",
        ",FNN_DIAS_AUSENT_BIMESTRE",
        ",FNN_ID_VIV_GARANTIA",
        ",FNN_APLIC_INT_VIVIENDA",
        ",FNC_MOTIVO_LIBCION_APORT",
        ",FND_FECHA_PAGO_CUOTA_GUB",
        ",FND_FECHA_VALOR_RCV",
        ",FNN_CVE_ENT_RECEP_PAGO",
        ",FNN_NSS_ISSSTE",
        ",FNC_DEPEND_CTRO_PAGO",
        ",FNN_CTRO_PAGO_SAR",
        ",FNN_CVE_RAMO",
        ",FNC_CVE_PAGADURIA",
        ",FNN_SUELDO_BASICO_COTIZ_RCV",
        ",FNC_ID_TRABAJADOR_BONO",
        ",FND_FEH_CRE",
        ",FNC_USU_CRE",
        ",FTN_INTERESES_VIV92",
        ",FTN_INTERESES_VIV08",
        ",FCN_ID_PROCESO",
        ",FCN_ID_SUBPROCESO",
        ",FNC_TIPREG",
        ",FTN_CONS_REG_LOTE",
        ",FNN_SECLOT",
        ",FNN_ID_ARCHIVO",
        ",FND_FECTRA",
        ",FCN_ID_TIPO_APO",
        "FROM #PARAM@1#",
        "WHERE FTC_FOLIO = '#PARAM@2#'"
      ]
    },
    {
      "step_id": "026",
      "subprocess": "Acreditacion DOIMSS",
      "description": [
        "#PARAM@1# = #CIERREN_ETL.TTSISGRAL_ETL_MOVIMIENTOS# =",
        "#PARAM@2# = #SR_FOLIO# ="
      ],
      "value": [
        "SELECT DISTINCT FTC_FOLIO",
        ",FTN_NUM_CTA_INVDUAL",
        ",FNN_ID_REFERENCIA",
        "FROM #PARAM@1#",
        "WHERE FTC_FOLIO = '#PARAM@2#'",
        "AND FTN_REG_ACREDITADO = 0"
      ]
    },
    {
      "step_id": "027",
      "subprocess": "Acreditacion DOIMSS",
      "description": ["#PARAM@1# = #GLOBAL_TEMP.TEMP_DOIMSS_ACR_01# ="],
      "value": [
        "SELECT ",
        "    FCN_ID_TIPO_SUBCTA,",
        "    FTC_FOLIO,",
        "    FTC_FOLIO_REL,",
        "    FCN_ID_SIEFORE,",
        "    FTF_MONTO_PESOS,",
        "    FTF_MONTO_ACCIONES,",
        "    FCN_ID_VALOR_ACCION,",
        "    FTN_NUM_CTA_INVDUAL,",
        "    FTN_ID_SEMAFORO_MOV,",
        "    FTD_FEH_LIQUIDACION,",
        "    16 AS FTD_ID_ESTATUS_MOV,",
        "    FTN_ID_MARCA,",
        "    FCN_ID_TIPO_MOV,",
        "    FCD_FEH_CRE,",
        "    FCC_USU_CRE,",
        "    FCD_FEH_ACT,",
        "    FCC_USU_ACT,",
        "    FCN_ID_CONCEPTO_MOV,",
        "    FNN_ID_REFERENCIA",
        "FROM #PARAM@1#",
        "WHERE SUBSTR(FCC_TABLA_NCI_MOV,1,3) = 'GOB'"
      ]
    }
  ]
}
